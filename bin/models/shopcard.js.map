{"version":3,"sources":["../src/models/shopcard.ts"],"names":[],"mappings":"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","file":"shopcard.js","sourcesContent":["import { AppRequest, ValidationError } from \"../lib/http\";\nimport Product from \"../db/models/product\";\nimport { PurchaseOption, ProductView, ProductButcherView } from \"./productView\";\nimport Helper from \"../lib/helper\";\nimport { Shipment, ShipmentType, ShipmentTypeDesc } from \"./shipment\";\nimport { Payment, PaymentType, PaymentTypeDesc } from \"./payment\";\nimport { Order } from \"../db/models/order\";\nimport * as _ from \"lodash\"\nimport { GeoLocation, LocationType } from \"./geo\";\n\nexport interface ShopcardAdres {\n    name: string;\n    email: string;\n    phone: string;\n    level1Id: number;\n    level2Id: number;\n    level3Id: number;\n    saveaddress: boolean;\n    adres: string;\n    bina: string;\n    kat: string;\n    daire: string;\n    addresstarif: string;\n    level1Text: string;\n    level2Text: string;\n    level3Text: string;\n    location?: GeoLocation;\n    accuracy?: number;\n\n    geolocation: GeoLocation;\n    geolocationType: LocationType;\n\n\n}\n\nclass Modifier {\n    type: 'discount' | 'puan'\n    code: string;\n    name: string;\n    percent: number;\n    net: number;\n    subTotal: number;\n}\n\nexport class Discount extends Modifier {\n    get calculated() {\n        if (this.percent > 0)\n            return Helper.asCurrency(-1 * this.subTotal * (this.percent / 100))\n        else return -1 * this.net\n    }\n}\n\nexport class ShippingCost extends Modifier {\n    get calculated() {\n        return this.net\n    }\n}\n\nexport let firstOrderDiscount = Object.assign(new Discount(), {\n    type: 'puan',\n    code: 'ilksiparis',\n    name: 'İlk sipariş indirimi',\n    percent: 3,\n    net: 0\n})\n\n// export let sub14OrderDiscount = Object.assign(new Discount(), {\n//     code: '14subat',\n//     name: '14 Şubat indirimi',\n//     percent: 5,\n//     net: 0\n// })\n\nexport interface ShopcardButcherView {\n    slug: string;\n    name: string;\n    id: number;\n    onlinePayment: boolean;\n    subTotal: number;\n    products: number[]\n}\n\nexport class ShopCard {\n    note: string;\n    address: ShopcardAdres = {\n        name: '',\n        email: '',\n        phone: '',\n        level1Id: 0,\n        level2Id: 0,\n        level3Id: 0,\n        saveaddress: true,\n        adres: '',\n        addresstarif:'',\n        bina:'',\n        kat:'',\n        daire:'',\n        level1Text: '',\n        level2Text: '',\n        level3Text: '',\n        location: null,\n        geolocation: null,\n        geolocationType: \"UNKNOWN\"\n    };\n    butchers: { [key: number]: ShopcardButcherView; } = {};\n    shipment: { [key: number]: Shipment; } = {};\n    payment: { [key: number]: Payment; } = {};\n    shippingCosts: { [key: number]: ShippingCost; } = {};\n    butcherDiscounts: { [key: number]: Discount[]; } = {};\n\n    discounts = [];\n\n\n    items: ShopcardItem[] = [];\n\n    getPaymentTotal(type: string) {\n        let total = 0.00;\n        for (var bi in this.payment) {\n            if (this.payment[bi].type == type) {\n                total += Helper.asCurrency(this.getButcherTotal(bi));\n            }\n        }\n        return Helper.asCurrency(total)\n    }\n\n    getButcherDiscountTotal(bi) {\n        let totalPrice = 0;\n        if (!this.butcherDiscounts[bi])\n            return 0.00;\n        this.butcherDiscounts[bi].forEach(d => (totalPrice += (d.type == 'discount' ? d.calculated: 0.00)));\n        return Helper.asCurrency(totalPrice);\n    }\n\n    getButcherTotal(bi) {\n        let totalPrice = this.butchers[bi].subTotal;\n        let discounts = this.getButcherDiscountTotal(bi);\n        let shippings = this.getShippingCostOfCustomer(bi);\n        return totalPrice + discounts + shippings;\n    }\n\n    getButcherTotalWithoutShipping(bi) {\n        let totalPrice = this.butchers[bi].subTotal;\n        let discounts = this.getButcherDiscountTotal(bi);\n        return totalPrice + discounts;\n    }    \n\n\n    // butcherDi(bi) {\n    //     let shipment = this.shipment[bi];\n    //     if (!shipment.dispatcher) \n\n    // }\n\n\n    get butcherDiscountTotal() {\n        let totalPrice = 0;\n        for (let s in this.butcherDiscounts) {\n            totalPrice += this.getButcherDiscountTotal(s)\n        }\n        return Helper.asCurrency(totalPrice)\n    }\n\n    get discountTotal() {\n        let totalPrice = 0;\n        this.discounts.forEach(p => {\n            totalPrice += (p.type=='discount' ? p.calculated: 0.00);\n        })\n        return Helper.asCurrency(totalPrice + this.butcherDiscountTotal)\n    }\n\n    get shippingTotal() {\n        let totalPrice = 0;\n        for (let s in this.shippingCosts)\n            totalPrice += this.shippingCosts[s].calculated;\n        return Helper.asCurrency(totalPrice)\n    }\n\n    get total() {\n        return this.subTotal + this.discountTotal + this.shippingTotal;\n    }\n\n\n    get subTotal() {\n        let totalPrice = 0;\n        this.items.forEach(p => {\n            totalPrice += p.price;\n        })\n        return Helper.asCurrency(totalPrice)\n    }\n\n\n\n    remove(i) {\n        this.items.splice(i, 1);\n        this.arrangeButchers();\n        this.calculateShippingCosts();\n    }\n\n    static calculatePrice(product: ProductView, quantity: number, purchaseoption: PurchaseOption) {\n        return Helper.asCurrency(purchaseoption.unitPrice * quantity);\n    }\n\n    // getShippingCostOfButcher(bi) {\n    //     let shipment = this.shipment[bi];\n    //     let butcher = this.butchers[bi];\n    //     if (shipment.howTo == \"take\")\n    //         return 0.00;\n    //     if (shipment.dispatcher && shipment.dispatcher.type == \"butcher\") {\n    //         if (shipment.dispatcher.totalForFree <= 0) {\n    //             return shipment.dispatcher.fee;\n    //         }\n    //         else return (Math.max(0.00, (shipment.dispatcher.totalForFree - butcher.subTotal > 0) ? shipment.dispatcher.fee : 0))\n    //     } else return 0.00;\n    // }\n\n\n    getShippingCostOfCustomer(bi) {\n        let shipment = this.shipment[bi];\n        let butcher = this.butchers[bi];\n        if (shipment.howTo == \"take\")\n            return 0.00;\n        if (shipment.dispatcher) {\n            return shipment.dispatcher.fee;\n            // shipment.dispatcher.provider.calculateFeeForCustomer({\n            //     orderTotal: butcher.subTotal\n            // })\n            // if (shipment.dispatcher.type == \"butcher\")\n            //     return this.getShippingCostOfButcher(bi)\n            // else {\n            //     if (shipment.dispatcher.calculateCostForCustomer) {\n            //         let result = shipment.dispatcher.calculateCostForCustomer(shipment)\n            //         return result;\n            //     } else return Helper.asCurrency(shipment.dispatcher.fee / 2);\n\n            // }  \n        } \n        return 0.00;\n    }    \n\n    calculateShippingCosts() {\n        this.shippingCosts = {};\n        for (let k in this.butchers) {\n            let butcher = this.butchers[k];\n            let shipment = this.shipment[k];\n            let cost = this.getShippingCostOfCustomer(k);\n            if (cost > 0) {\n                this.shippingCosts[k] = new ShippingCost();\n                this.shippingCosts[k].name = butcher.name;\n                this.shippingCosts[k].net = cost;\n                this.shippingCosts[k].subTotal = butcher.subTotal;\n            }\n        }\n    }\n\n    arrangeButchers() {\n        let shipment = {};\n        let payment = {};\n        let butchers = {}\n\n        this.items.forEach((item, i) => {\n            let bi = item.product.butcher.id\n            if (!butchers[bi]) {\n                butchers[bi] = item.product.butcher;\n                butchers[bi].products = [i];\n                butchers[bi].subTotal = item.price;\n            } else {\n                butchers[bi].products.push(i);\n                butchers[bi].subTotal += item.price;\n            }\n            if (this.shipment[bi])\n                shipment[bi] = this.shipment[bi];\n            else shipment[bi] = new Shipment();\n            if (this.payment[bi])\n                payment[bi] = this.payment[bi];\n            else {\n                let preferred = butchers[bi].enableCreditCard ? 'onlinepayment' : 'cashondoor';\n                payment[bi] = Object.assign(new Payment(), {\n                    type: preferred,\n                    desc: PaymentTypeDesc[preferred]\n                })\n            }\n\n        })\n        this.butchers = butchers;\n        this.shipment = shipment;\n        this.payment = payment;\n    }\n\n    addProduct(product: ProductView, quantity: number, purchaseoption: PurchaseOption, note: string, productTypeData: any = {}) {\n        quantity = Number(quantity.toFixed(3));\n        let price = ShopCard.calculatePrice(product, quantity, purchaseoption);\n        //let found = null; // this.items.find(p => p.note == note && p.product.id == product.id && p.purchaseoption.id == purchaseoption.id && p.product.butcher.id == product.butcher.id);\n        // if (found) {\n        //     found.quantity = quantity + found.quantity;\n        //     found.price = price + found.price;\n        // }\n        this.items.push(new ShopcardItem(product, quantity, price, purchaseoption, note, productTypeData));\n        \n        let removed = [];\n\n        if (product.productType == 'kurban') {\n            this.items = this.items.filter(p=>p.product.productType == 'kurban')\n        } else {\n            this.items = this.items.filter(p=>p.product.productType != 'kurban')                      \n        }\n        this.arrangeButchers();\n        this.calculateShippingCosts();\n    }\n\n    constructor(values: any) {\n        this.items = [];\n        this.note = values.note || \"\";\n        values = values || {};\n        values.items = values.items || [];\n        values.items.forEach(i => {\n            let item = new ShopcardItem(i.product, i.quantity, i.price, i.purchaseoption, i.note,i.productTypeData || {});\n            this.items.push(item)\n        })\n        values.address = values.address || this.address;\n        this.address = values.address;\n\n        values.butchers = values.butchers || this.butchers;\n        this.butchers = values.butchers;\n\n        values.shipment = values.shipment || {};\n        this.shipment = {}\n        Object.keys(values.shipment).forEach(k => {\n            let o = Object.assign(new Shipment(), values.shipment[k]);\n            this.shipment[k] = o;\n        })\n\n        values.payment = values.payment || {};\n        this.payment = {}\n        Object.keys(values.payment).forEach(k => {\n            let o = Object.assign(new Payment(), values.payment[k]);\n            this.payment[k] = o;\n        })\n\n        let discounts = values.discounts || [];\n        let subTotal = this.subTotal;\n\n        discounts.forEach(d => {\n            let o = Object.assign(new Discount(), d);\n            o.subTotal = subTotal\n            this.discounts.push(o)\n        })\n\n        values.butcherDiscounts = values.butcherDiscounts || {};\n        this.butcherDiscounts = {}\n        Object.keys(values.butcherDiscounts).forEach(k => {\n            let discounts = values.butcherDiscounts[k] || []\n            discounts.forEach((element, i) => {\n                let o = Object.assign(new Discount(), element);\n                discounts[i] = o;\n            });\n\n            this.butcherDiscounts[k] = discounts;\n        })\n\n        values.shippingCosts = values.shippingCosts || {};\n        this.shippingCosts = {}\n        Object.keys(values.shippingCosts).forEach(k => {\n            let o = Object.assign(new ShippingCost(), values.shippingCosts[k]);\n            this.shippingCosts[k] = o;\n        })\n\n    }\n\n    clearBeforeSave() {\n        // for (let o in this.shipment) {\n        //     this.shipment[o].dispatcher = undefined\n        // }\n    }\n\n    async saveToRequest(req: AppRequest) {\n        this.clearBeforeSave();\n        if (req.user) {\n            req.user.shopcard = this\n            await req.user.save();\n            return this;\n        } else if (req.session) {\n            req.session.shopcard = this;\n            return new Promise((resolve, reject) => {\n                req.session.save((err) => err ? reject(err) : resolve())\n            })\n            return this;\n        }\n    }\n\n    static async empty(req: AppRequest) {\n        if (req.user) {\n            req.user.shopcard = null;\n            await req.user.save()\n        }\n        req.session.shopcard = null;\n        return new Promise((resolve, reject) => {\n            req.session.save((err) => err ? reject(err) : resolve())\n        })\n    }\n\n    addButcherDiscount(bi, discount: Discount) {\n        if (!this.butcherDiscounts[bi])\n            this.butcherDiscounts[bi] = [];\n        this.butcherDiscounts[bi].push(discount)\n    }\n\n    removeButcherDiscount(bi, code: string) {\n        if (this.butcherDiscounts[bi]) {\n            _.remove(this.butcherDiscounts[bi], p => p.code == code)\n        }\n        this.butcherDiscounts[bi].length == 0 && delete this.butcherDiscounts[bi];\n\n    }\n\n    getOrderType() {\n        if (this.items.length && this.items[0].product.productType == 'kurban') {\n            return 'kurban'\n        } else return 'generic'\n    }\n\n\n    getButcherDiscount(bi, code: string) {\n        if (!this.butcherDiscounts[bi])\n            return null;\n        return this.butcherDiscounts[bi].find(p => p.code == code)\n    }\n\n    async manageDiscounts() {\n        // for(let b in this.butchers) {                \n        //     let discountTotal = this.getButcherDiscountTotal(b);\n        //     let discounts = this.butcherDiscounts[b];\n        //     let butcherProducts = this.butchers[b].products;\n        //     butcherProducts.forEach((pi) => {\n        //         let product = this.items[pi];\n                \n        //     })\n        // }        \n\n\n        // for(let b in this.butchers) {                \n        //     let applied = this.getButcherDiscount(b, sub14OrderDiscount.code);\n        //     if (applied) {\n        //         this.removeButcherDiscount(b, sub14OrderDiscount.code)  \n        //         applied = null;\n        //      }\n\n        //     if (!applied) {\n        //         this.addButcherDiscount(b, Object.assign(new Discount(), {\n        //             code: sub14OrderDiscount.code,\n        //             percent: sub14OrderDiscount.percent,\n        //             name: sub14OrderDiscount.name,\n        //             subTotal: this.butchers[b].subTotal\n        //         }))    \n        //     }\n        // }        \n    }\n\n    async manageFirstOrderDiscount(hasFirstOrder: Order) {\n        firstOrderDiscount.subTotal = this.subTotal;\n        for (let b in this.butchers) {\n            let applied = this.getButcherDiscount(b, firstOrderDiscount.code);\n            if (applied) {\n                this.removeButcherDiscount(b, firstOrderDiscount.code)\n                applied = null;\n            }\n            if (!applied) {\n                if (!hasFirstOrder ) {\n                    this.addButcherDiscount(b, Object.assign(new Discount(), {\n                        type: firstOrderDiscount.type,\n                        code: firstOrderDiscount.code,\n                        percent: firstOrderDiscount.percent,\n                        name: firstOrderDiscount.name,\n                        subTotal: this.butchers[b].subTotal\n                    }))\n                }\n            } else {\n                if (hasFirstOrder) {\n                    this.removeButcherDiscount(b, firstOrderDiscount.code)\n                }\n            }\n        }\n\n\n\n        // let firstOrderApplied = this.discounts.find(p => p.code == firstOrderDiscount.code);\n        // if (!firstOrderApplied) {\n        //     if (!firstOrder)\n        //         this.discounts.push(firstOrderDiscount)\n        // } else {\n        //     if (firstOrder)\n        //         _.remove(result.discounts, p => p.code == firstOrderDiscount.code)\n        // }\n    }\n\n    static async createFromRequest(req: AppRequest): Promise<ShopCard> {\n        let result: ShopCard;\n        if (req.user && req.user.shopcard != null) {\n            result = new ShopCard(req.user.shopcard)\n        } else if (req.session.shopcard != null) {\n            result = new ShopCard(req.session.shopcard);\n        } else result = new ShopCard({});\n\n        if (req.prefAddr) {\n            result.address.level1Id = req.prefAddr.level1Id;\n            result.address.level1Text = req.prefAddr.level1Text;\n\n            result.address.level2Id = req.prefAddr.level2Id;\n            result.address.level2Text = req.prefAddr.level2Text;\n\n            result.address.level3Id = req.prefAddr.level3Id;\n            result.address.level3Text = req.prefAddr.level3Text;\n        }\n\n        let butcherids = Object.keys(result.butchers || {})\n\n        let firstOrder = !req.user ? null : await Order.findOne({\n            where: {\n                userid: req.user.id,\n                butcherid: butcherids\n            }\n        })\n        result.butcherDiscounts = {}\n        await result.manageFirstOrderDiscount(firstOrder);\n        await result.manageDiscounts();\n        return result;\n    }\n}\n\nexport class ShopcardItem {\n    // public discount: number = 0.00;\n    constructor(public product: ProductView,\n        public quantity: number, public price: number,\n        public purchaseoption: PurchaseOption, public note: string, public productTypeData: Object) {\n        if (!product) throw new ValidationError('geçersiz ürün');\n        if (!quantity) throw new ValidationError('geçersiz miktar:' + product.name);\n        if (!price) throw new ValidationError('geçersiz bedel: ' + product.name);\n    }\n}"],"sourceRoot":"../../src/"}