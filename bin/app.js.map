{"version":3,"sources":["../src/app.ts"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["import * as express from 'express';\nconst compression = require('compression')\n\nimport * as bp from 'body-parser';\nimport * as http from 'http';\nimport { AppRequest } from './lib/http'\nimport config from \"./config\";\nimport * as path from 'path';\nimport * as cors from 'cors';\nimport adminPageRoutes from './routes/admin';\nimport butcherPageRoutes from './routes/butcher/index';\nimport operatorPageRoutes from './routes/operator/index';\nimport apiRoutes from './routes/api';\nimport butcherApiRoutes from './routes/api/butcherapirouter';\nimport userApiRoutes from './routes/api/userapirouter';\nimport db from \"./db/context\";\nimport User from './db/models/user';\nimport UserRoute from './routes/api/user';\nimport ViewRoutes from './routes/index';\nimport UserRoutes from './routes/user';\nimport Butcher from './routes/api/butcher';\nimport Area from './db/models/area';\nimport * as session from \"express-session\";\nimport { CacheManager } from \"./lib/cache\";\nimport Category from './db/models/category';\nimport * as _ from \"lodash\";\nimport middlewares from './middleware/index'\nimport ErrorMiddleware from './middleware/error'\nimport * as cookieParser from 'cookie-parser';\nconst flash = require('connect-flash');\nimport { RequestHelper } from './lib/RequestHelper';\nimport iyzico from './lib/payment/iyzico';\nimport Tasks from './lib/tasks/index';\nimport paratika from './lib/payment/paratika';\n\nconst SessionStore = require('express-session-sequelize')(session.Store);\nconst fileUpload = require('express-fileupload');\n\nimport * as bluebird from \"bluebird\";\nimport BanabikuryeProvider from './lib/logistic/banabikurye';\nimport { ButcherManualLogistics, ButcherAutoLogistics } from './lib/logistic/butcher';\n\nbluebird.config({\n    warnings: false\n});\n\nclass KasaptanAlApp {\n    app: express.Application;\n    apiRouter: express.Router;\n    butcherApiRouter: express.Router;\n    userApiRouter: express.Router;\n    viewsRouter: express.Router;\n    userRouter: express.Router;\n    adminPagesRouter: express.Router;\n    butcherPagesRouter: express.Router;\n    operatorPagesRouter: express.Router;\n    sitemap: any;\n\n\n    async shopcard() {\n\n\n        this.app.use((req: AppRequest, res, next) => {\n            let list = [];\n            if (req.user && req.session.shopcard != null) {\n                req.user.shopcard = req.session.shopcard;\n                req.session.shopcard = null;\n                list.push(req.user.save());\n            } else if (req.user && req.user.shopcard && req.session.shopcard != null) {\n            }\n\n\n            Promise.all(list).then(r => {\n                res.locals.__shopcard = () => (req.user ? req.user.shopcard : req.session.shopcard);\n                next();\n            }).catch(next)\n        })\n    }\n\n    constructor() {\n\n    }\n\n    async bootstrap() {\n\n        let dbinstance = await db.init();        \n        this.app = express();\n        this.app.use(compression())\n        this.app.use(fileUpload())\n        this.app.use(cors({\n\n        }))\n\n        const sequelizeSessionStore = new SessionStore({\n            db: dbinstance,\n        });\n\n        let sess = {\n            secret: 'kasaplarin efendisi',\n            cookie: <any>{},\n            store: sequelizeSessionStore,\n            resave: false,\n            saveUninitialized: true\n        }\n\n        if (config.nodeenv === 'production') {\n            this.app.set('trust proxy', 1) // trust first proxy\n            sess.cookie.secure = true // serve secure cookies\n        }\n\n        iyzico.register();\n        paratika.register();\n        BanabikuryeProvider.register();\n        ButcherManualLogistics.register();\n        ButcherAutoLogistics.register();\n        \n        this.app.use((req, res, next) => {\n            let proto = req.header(\"x-forwarded-proto\") || null;\n            let host = (req.get('Host') || \"\").toLowerCase();\n\n            if (proto && host == \"kasaptanal.com\")\n                return res.redirect(301, \"https://www.kasaptanal.com\" + req.originalUrl)\n\n            // if (proto && proto != \"https\")\n            //     return res.redirect(301, \"https://www.kasaptanal.com\" + req.originalUrl)\n\n            return next()\n        })\n\n\n        this.app.use(cookieParser());\n        this.app.use(session(sess));\n        // this.app.set('etag', 'strong');  \n\n        this.apiRouter = express.Router();\n        this.adminPagesRouter = express.Router();\n        this.butcherApiRouter = express.Router();\n        this.userApiRouter = express.Router();\n        \n        this.userRouter = express.Router();\n        this.viewsRouter = express.Router();\n        this.butcherPagesRouter = express.Router();\n        this.operatorPagesRouter = express.Router();\n\n        this.app.use(bp.json())\n        this.app.use(bp.urlencoded({ extended: false }));\n        this.app.use(bp.text());\n        this.app.use(bp.raw());\n        this.app.use(flash());\n\n        middlewares.use(this.app);\n        CacheManager.use(this.app);\n        RequestHelper.use(this.app);\n        this.shopcard()\n\n        this.app.use('/robots.txt', function (req, res, next) {\n            res.sendFile(path.join(__dirname, '../public/robots.txt'));\n        });\n\n        if (config.nodeenv == 'development') {\n            this.app.use('/static/resource', express.static(path.join(__dirname, '../public')));            \n            this.app.use('/static', express.static(path.join(__dirname, '../public')));            \n        } else {\n\n        }\n        this.app.set('view engine', 'ejs');\n        this.app.set('views', path.join(__dirname, '../src/views'));\n \n\n\n\n        this.app.use('/api/v1', this.apiRouter);\n\n        this.app.use('/api/v1/butcher', (req: AppRequest, res, next) => {\n            if (req.user && (req.user.hasRole('admin') || req.user.hasRole('butcher')))\n                next();\n            else res.redirect('/login?r=' + req.originalUrl)\n        }, this.butcherApiRouter);\n\n        this.app.use('/api/v1/user', (req: AppRequest, res, next) => {\n            if (req.user)\n                next();\n            else res.redirect('/login?r=' + req.originalUrl)\n        }, this.userApiRouter);\n\n        this.app.use('/pages/admin', (req: AppRequest, res, next) => {\n            if (req.user && (req.user.hasRole('admin') || req.user.hasRole('seo')))\n                next();\n            else res.redirect('/login?r=' + req.originalUrl)\n        }, this.adminPagesRouter);\n\n        this.app.use('/kasapsayfam', (req: AppRequest, res, next) => {\n            if (req.user && (req.user.hasRole('butcher') || req.user.hasRole('admin')))\n                next();\n            else res.redirect('/login?r=' + req.originalUrl)\n        }, this.butcherPagesRouter); \n\n        this.app.use('/pages/operator', (req: AppRequest, res, next) => {\n            if (req.user && (req.user.hasRole('admin') || req.user.hasRole('operator')))\n                next();\n            else res.redirect('/login?r=' + req.originalUrl)\n        }, this.operatorPagesRouter);                     \n\n        this.app.use('/user', (req: AppRequest, res, next) => {\n            if (!req.user) res.redirect('/login')\n            else next()\n        }, this.userRouter);\n\n        this.app.use(\"/\", this.viewsRouter);\n        apiRoutes.use(this.apiRouter);\n        butcherApiRoutes.use(this.butcherApiRouter);\n        userApiRoutes.use(this.userApiRouter);\n        adminPageRoutes.use(this.adminPagesRouter);\n        butcherPageRoutes.use(this.butcherPagesRouter);\n        operatorPageRoutes.use(this.operatorPagesRouter);\n        ViewRoutes.use(this.viewsRouter);\n        UserRoutes.use(this.userRouter);\n\n        ErrorMiddleware(this.app);\n\n        const server = http.createServer(this.app);\n\n        server.once('error', (err: any) => {\n            if (err.code === 'EADDRINUSE') {\n                console.log(err);\n                process.exit(2);\n            }\n        });\n\n  \n\n        Tasks.start();\n\n        return new Promise((resolve, reject) => {\n            server.listen(config.port, () => {\n                resolve();\n            });\n        });\n\n\n    }\n}\n\nexport var App: KasaptanAlApp;\n\nexport default () => (App = new KasaptanAlApp());\n\n\n\n\n"],"sourceRoot":"../src/"}