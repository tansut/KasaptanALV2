{"version":3,"sources":["../src/routes/product.ts"],"names":[],"mappings":"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","file":"product.js","sourcesContent":["import { ApiRouter, ViewRouter } from '../lib/router';\nimport * as express from \"express\";\nimport * as maps from \"@google/maps\"\nimport ProductModel, { ProductType } from '../db/models/product';\nimport { Auth, ProductTypeManager, ProductTypeFactory } from '../lib/common';\nimport Helper from '../lib/helper';\nimport Resource from '../db/models/resource';\nimport ResourceRoute from './resource';\nimport * as sq from 'sequelize';\n\nimport * as path from \"path\"\nimport * as Jimp2 from 'jimp'\nconst Jimp = <Jimp2>require('jimp');\nimport * as fs from \"fs\"\nimport moment = require('moment');\nimport Category from '../db/models/category';\nimport Butcher from '../db/models/butcher';\nimport ProductApi from './api/product';\nimport DispatcherApi from './api/dispatcher';\nimport Area from '../db/models/area';\nimport ButcherProduct from '../db/models/butcherproduct';\nimport Dispatcher, { DispatcherSelection } from '../db/models/dispatcher';\nimport { PreferredAddress } from '../db/models/user';\nvar MarkdownIt = require('markdown-it')\nimport * as _ from \"lodash\";\nimport { ResourceCacheItem, ProductCacheItem } from '../lib/cache';\nimport { ShopCard, ShopcardItem } from '../models/shopcard';\nimport config from '../config';\nimport { Op, Sequelize, where } from 'sequelize';\nimport { ProductLd } from '../models/ProductLd';\nimport ProductCategory from '../db/models/productcategory';\nimport Review from '../db/models/review';\nimport Product from '../db/models/product';\nimport { PuanCalculator } from '../lib/commissionHelper';\n\ninterface ButcherSelection {\n    best: Dispatcher,\n    servingL1: Dispatcher[]\n    servingL2: Dispatcher[]\n    servingL3: Dispatcher[]\n    takeOnly: Butcher[]\n}\n\nexport default class Route extends ViewRouter {\n\n    butcherProducts: ButcherProduct[] = [];\n    markdown = new MarkdownIt();\n    foods: Resource[] = [];\n    butcherResources: Resource[] = [];\n    productLd: ProductLd;\n    product: Product;\n    reviews: Review[] = [];\n    shopCardIndex: number = -1;\n    shopCardItem: ShopcardItem = null;\n    dispatchingAvailable: boolean = true;\n\n    productTypeManager: ProductTypeManager = null;\n\n\n    get ProductTypeManager() {\n        let params = {\n            product: this.product\n        }\n        if (this.shopCardItem && this.shopCardItem.productTypeData) {\n            params = {...params, ...this.shopCardItem.productTypeData }\n        }\n        let result = this.productTypeManager || (this.productTypeManager = ProductTypeFactory.create(this.product.productType, params))\n        return result;\n    }\n\n\n\n\n    async tryBestFromShopcard(serving: Dispatcher[], others: Dispatcher[] = []) {\n        let shopcard = await ShopCard.createFromRequest(this.req);\n        let scButcher = (shopcard.items && shopcard.items.length) ? shopcard.items[0].product.butcher.id : null;\n        if (scButcher) {\n            let inServing = serving.find(p => p.butcherid == scButcher);\n            let inOther = others.find(p => p.butcherid == scButcher);\n            return inServing || inOther\n        } else return null;\n    }\n\n    async tryBestFromOrders(serving: Dispatcher[]) {\n        let fullServing = serving.filter(s => s.selection == DispatcherSelection.full);\n        if (fullServing.length == 0) fullServing = serving;\n        fullServing.forEach(s => s.lastorderitemid = s.lastorderitemid || 0);\n        let orderedByDate = _.orderBy(fullServing, 'lastorderitemid', 'asc');\n        let orderedByKasapCard = _.orderBy(orderedByDate, 'butcher.enablePuan', 'desc');\n        return orderedByKasapCard.length ? orderedByKasapCard[0] : null;\n    }\n\n    tryBestAsRandom(serving: Dispatcher[]) {\n        let fullServing = serving.filter(s => s.selection == DispatcherSelection.full);\n        if (fullServing.length == 0) fullServing = serving;\n        let res = (fullServing.length > 0 ? fullServing[0] : null);\n        return res;\n    }\n\n    useL1(product: Product) {\n        return (product.productType == ProductType.adak || product.productType == ProductType.kurban)    \n    }\n\n    async bestButchersForProduct(product: Product, adr: PreferredAddress, userBest: Butcher): Promise<ButcherSelection> {\n        let api = new DispatcherApi(this.constructorParams);\n\n        let serving = await api.getButchersSelingAndDispatches(adr, product,\n            this.useL1(product)\n        );\n\n        let takeOnly = serving.filter(p => p.takeOnly == true);\n        let servingL3 = serving.filter(p => p.toarealevel == 3 && !p.takeOnly);\n        let servingL2 = serving.filter(p => p.toarealevel == 2 && !p.takeOnly && (servingL3.find(m => m.butcher.id == p.butcher.id) == null));\n        let servingL1 = serving.filter(p => p.toarealevel == 1 && !p.takeOnly && (servingL2.find(m => m.butcher.id == p.butcher.id) == null) && (servingL3.find(m => m.butcher.id == p.butcher.id) == null));\n\n\n        takeOnly = Helper.shuffle(takeOnly)\n        servingL3 = Helper.shuffle(servingL3)\n        servingL2 = Helper.shuffle(servingL2)\n        servingL1 = Helper.shuffle(servingL1)\n\n        let mybest: Dispatcher = await this.tryBestFromShopcard(serving) ||\n            await this.tryBestFromOrders(servingL3) ||\n            await this.tryBestFromOrders(servingL2) || \n            await this.tryBestFromOrders(servingL1) || \n            this.tryBestAsRandom(serving);\n\n        if (mybest) {\n            mybest = (userBest ? (serving.find(s => s.butcherid == userBest.id)) : null) || mybest;\n        }\n\n        return {\n            best: mybest,\n            servingL1: servingL1,\n            servingL2: servingL2,\n            servingL3: servingL3,\n            takeOnly: takeOnly\n        }\n    }\n\n    @Auth.Anonymous()\n    async productRoute() {\n        if (!this.req.params.product) {\n            return this.next();\n        }\n        let product = await ProductModel.findOne({\n            include: [{\n                model: ProductCategory,\n                include: [Category]\n            }\n            ], where: { slug: this.req.params.product }\n        });\n        if (!product) return this.next();\n        this.product = product;\n        let api = new ProductApi(this.constructorParams);\n\n\n        await product.loadResources();\n        this.reviews = await api.loadReviews(product.id);\n\n        let shopcard = await ShopCard.createFromRequest(this.req);\n\n        this.shopCardIndex = this.req.query.shopcarditem ? parseInt(this.req.query.shopcarditem as string) : -1;\n        this.shopCardItem = (this.shopCardIndex >= 0 && shopcard.items) ? shopcard.items[this.shopCardIndex] : null;\n\n        let butcher = this.shopCardItem ? await Butcher.getBySlug(this.shopCardItem.product.butcher.slug) : (this.req.query.butcher ? await Butcher.getBySlug(this.req.query.butcher as string) : null);\n\n        this.foods = await api.getTarifVideos([product])\n        if (this.req.query.semt) {\n            let l3 = await Area.getBySlug(this.req.query.semt as string);\n            if (l3 && l3.level == 3) {\n                await this.req.helper.setPreferredAddress({\n                    level3Id: l3.id\n                }, true)\n            }\n        }\n\n\n\n\n        let selectedButchers: ButcherSelection;\n\n        if (!this.req.prefAddr) {\n            selectedButchers = {\n                best: null,\n                servingL1: [],\n                servingL2: [],\n                servingL3: [],\n                takeOnly: []\n            }\n        } else\n            selectedButchers = await this.bestButchersForProduct(product, this.req.prefAddr, butcher);\n\n        let serving = selectedButchers.servingL3.concat(selectedButchers.servingL2).concat(selectedButchers.servingL1).concat(<any>selectedButchers.takeOnly);\n\n\n        if (selectedButchers.best && this.req.query.butcher && (selectedButchers.best.butcher.slug != this.req.query.butcher)) {\n            serving = [];\n            selectedButchers.best = null;\n        }\n        \n        let view = await api.getProductView(product, selectedButchers.best ? selectedButchers.best.butcher : null, null, true)\n\n\n        serving.forEach(s => {\n            let butcher = s instanceof Dispatcher ? s.butcher : s;\n            let dispatcher = s instanceof Dispatcher ? s : null;\n            if (view.butcher && (butcher.id != view.butcher.id)) {\n                let bp = butcher.products.find(bp => bp.productid == product.id);\n                view.alternateButchers.push({\n                    butcher: {\n                        id: butcher.id,\n                        enableCreditCard: butcher.enableCreditCard,\n                        slug: butcher.slug,\n                        badges: butcher.getBadgeList(),\n                        userRatingAsPerc: butcher.userRatingAsPerc,\n                        shipRatingAsPerc: butcher.shipRatingAsPerc,\n                        name: butcher.name,\n                        puanData: butcher.getPuanData(this.product.productType),\n                        earnedPuan: 0.00,\n                        kgPrice: bp ? bp.kgPrice : 0,\n                        productNote: bp ? (bp.mddesc ? this.markdown.render(bp.mddesc) :\"\" ): \"\",\n                        thumbnail: this.req.helper.imgUrl(\"butcher-google-photos\", butcher.slug)\n                    },\n                    dispatcher: dispatcher ? {\n                        id: dispatcher.id,\n                        fee: dispatcher.fee,\n                        min: dispatcher.min,\n                        totalForFree: dispatcher.totalForFree,\n                        type: dispatcher.type,\n                        priceInfo: dispatcher.priceInfo,\n                        userNote: dispatcher.userNote,\n                        takeOnly: dispatcher.takeOnly\n                    } : null,\n                    purchaseOptions: api.getPurchaseOptions(product, bp).map(po => {\n                        return {\n                            unit: po.unit,\n                            unitTitle: po.unitTitle,\n                            unitPrice: po.unitPrice\n                        }\n                    })\n                })\n            } else if (view.butcher && view.butcher.id == s.butcher.id) {\n                view.dispatcher = dispatcher ? {\n                    id: dispatcher.id,\n                    fee: dispatcher.fee,\n                    min: dispatcher.min,\n                    totalForFree: dispatcher.totalForFree,\n                    type: dispatcher.type,\n                    priceInfo: dispatcher.priceInfo,\n                    userNote: dispatcher.userNote,\n                    takeOnly: dispatcher.takeOnly\n                } : null\n            }\n        })\n\n\n\n\n        if (view.butcher) {\n            let calculator = new PuanCalculator();\n            view.butcher.earnedPuan = this.req.user ? await calculator.getEarnedButcherPuan(this.req.user.id, view.butcher.id) : 0.00\n            this.butcherProducts = await ButcherProduct.findAll({\n                where: {\n                    butcherid: view.butcher.id,\n                    vitrin: true,\n\n                    [Op.or]: [\n                        {\n                            kgPrice: {\n                                [Op.gt]: 0\n                            }\n                        },\n                        {\n                            unit1price: {\n                                gt: 0.0\n                            }\n                        },\n                        {\n                            unit2price: {\n                                [Op.gt]: 0.0\n                            }\n                        },\n                        {\n                            unit3price: {\n                                [Op.gt]: 0.0\n                            }\n                        }\n                    ]\n                },\n                include: [\n                    {\n                        model: ProductModel\n                    }\n                ]\n            })\n        }\n        if (view.butcher) {\n            this.butcherResources = await Resource.findAll({\n                where: {\n                    type: [\"butcher-google-photos\", \"butcher-videos\"],\n                    ref1: view.butcher.id,\n                    list: true\n                },\n                order: [[\"displayOrder\", \"DESC\"], [\"updatedOn\", \"DESC\"]]\n            })\n        }\n\n        this.productLd = product.reviewCount > 0 ? await api.getProductLd(product) : null;\n\n        this.dispatchingAvailable = this.req.prefAddr && (view.butcher != null || await new DispatcherApi(this.constructorParams).dispatchingAvailable(this.req.prefAddr, this.useL1(this.product)));\n\n        this.res.render('pages/product', this.viewData({\n            butcherProducts: this.butcherProducts.map(p => p.product), butchers: selectedButchers,\n            pageTitle: product.name + ' Siparişi ve Fiyatları',\n            // pageDescription: product.pageDescription + ' ', \n\n\n            pageThumbnail: this.req.helper.imgUrl('product-photos', product.slug),\n            pageDescription: product.generatedDesc,\n            product: product, view: view,\n            __supportMessage: `${`Merhaba, kasaptanal.com üzerinden size ulaşıyorum. ${product.name} ile ilgili whatsapp üzerinden yardımcı olabilir misiniz?`}`\n        }))\n\n    }\n\n\n    @Auth.Anonymous()\n    async productPhotoRoute() {\n        if (!this.req.params.product || !this.req.params.filename) return this.next();\n        let product = this.req.__products[this.req.params.product];\n\n        if (!product) return this.next();\n\n        let photo: ResourceCacheItem, thumbnail = false, url = \"\";\n\n        let res = new ResourceRoute(this.constructorParams)\n\n        let type = \"product-photos\";\n        let defaultFile = \"public/img/product-default-thumbnail.jpg\"\n        if (this.req.params.filename == \"thumbnail\") {\n            thumbnail = true;\n            photo = this.req.helper.getResourcesOfType(type + product.id).find(p => p.ref1 == product.id)\n        }\n        else photo = this.req.helper.getResourcesOfType(type + this.req.params.filename).find(p => p.contentUrl == this.req.params.filename);\n        res.sendResource(photo, thumbnail, thumbnail ? defaultFile : null)\n    }\n\n\n\n    static SetRoutes(router: express.Router) {\n        router.get(\"/:product\", Route.BindRequest(Route.prototype.productRoute));\n        // router.get(\"/:product/yemek-tarifi/:tarif\", Route.BindRequest(Route.prototype.productRoute));\n        // router.get(\"/:product/ile-yapin/:tarif\", Route.BindRequest(Route.prototype.productRoute));\n        //router.get(\"/:product\", Route.BindRequest(Route.prototype.productRoute));\n        config.nodeenv == 'development' ? router.get(\"/:product/resimler/:filename\", Route.BindRequest(Route.prototype.productPhotoRoute)) : null;\n    }\n}"],"sourceRoot":"../../src/"}