{"version":3,"sources":["../src/routes/category.ts"],"names":[],"mappings":"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","file":"category.js","sourcesContent":["import { ApiRouter, ViewRouter } from '../lib/router';\nimport * as express from \"express\";\nimport * as maps from \"@google/maps\"\nimport ButcherModel from '../db/models/butcher';\nimport moment = require('moment');\nimport { Auth } from '../lib/common';\nimport AreaModel from '../db/models/area';\nimport Helper from '../lib/helper';\nimport Area from '../db/models/area';\nimport Category, { CategorySubItemsMode } from '../db/models/category';\nimport Resource from '../db/models/resource';\nlet ellipsis = require('text-ellipsis');\nimport ResourceRoute from './resource';\nimport Product from '../db/models/product';\nimport ProductManager from '../lib/productManager';\nimport ProductsApi from './api/product';\nimport { ResourceCacheItem } from '../lib/cache';\nimport { Op } from 'sequelize';\nimport config from '../config';\nvar MarkdownIt = require('markdown-it')\nimport * as _ from \"lodash\";\nimport SubCategory from '../db/models/subcategory';\nimport { flatMap } from 'lodash';\n\nexport default class Route extends ViewRouter {\n    markdown = new MarkdownIt();\n    category: Category;\n    products: Product[];\n    foods: Resource[] = [];\n    foodsWithCats = {}\n    foodCategory = \"\"\n    _ = _;\n    subCategories: SubCategory[] = [];\n\n\n\n\n    renderPage(view: string, viewAsTarif: boolean = false) {\n        let pageTitle = viewAsTarif ? (this.category.tarifPageTitle || this.category.tarifTitle) : this.category.pageTitle;\n        let pageDescription = viewAsTarif ? this.category.tarifPageDesc : this.category.pageDescription;\n        let append = (viewAsTarif || this.category.type == 'resource') ? '' : '';\n        this.res.render(view, this.viewData({\n            pageTitle: (pageTitle || this.category.name + ' Et Lezzetleri') + append,\n            pageDescription: pageDescription,\n            pageThumbnail: this.req.helper.imgUrl('category-photos', this.category.slug)\n        }))\n    }\n\n    getFoods(category: Category) {\n        return this.foodsWithCats[category.id] || [];\n    }\n\n    generateFoodWithCats(foods: Resource[]) {\n        let res = {};\n\n        foods.forEach(f => {\n            f.categories.forEach(fc => {\n                if (!res[fc.categoryid])\n                    res[fc.categoryid] = [];\n                res[fc.categoryid].push(f);\n            })\n\n        })\n        return res;\n    }\n\n    async fillFoodsAndTarifs(categoryid?: number, subcategory?: string, discardFoodCategory: boolean = false) {\n        if (subcategory) {\n            let category = this.req.__categories.find(p => p.slug == subcategory);\n            this.products = await ProductManager.getProductsOfCategories([category.id])\n            this.foods = await new ProductsApi(this.constructorParams).getFoodAndTarifResources(this.products, null, (categoryid && !discardFoodCategory) ? [categoryid] : null);\n            this.foodsWithCats = this.generateFoodWithCats(this.foods)\n        } else {\n            this.foods = await new ProductsApi(this.constructorParams).getFoodAndTarifResources(null, null, categoryid ? [categoryid] : null);\n            this.foodsWithCats = this.generateFoodWithCats(this.foods)\n        }\n    }\n\n\n    async fillFoods(categoryid?: number, subcategory?: string, discardFoodCategory: boolean = false) {\n        if (subcategory) {\n            let category = this.req.__categories.find(p => p.slug == subcategory);\n            this.products = await ProductManager.getProductsOfCategories([category.id])\n            this.foods = await new ProductsApi(this.constructorParams).getFoodResources(this.products, null, (categoryid && !discardFoodCategory) ? [categoryid] : null);\n            this.foodsWithCats = this.generateFoodWithCats(this.foods)\n        } else {\n            this.foods = await new ProductsApi(this.constructorParams).getFoodResources(null, null, categoryid ? [categoryid] : null);\n            this.foodsWithCats = this.generateFoodWithCats(this.foods)\n        }\n    }\n\n    async fillTarifs(categoryid?: number, subcategory?: string, discardFoodCategory: boolean = false) {\n        if (subcategory) {\n            let category = this.req.__categories.find(p => p.slug == subcategory);\n            this.products = await ProductManager.getProductsOfCategories([category.id])\n            this.foods = await new ProductsApi(this.constructorParams).getTarifResources(this.products, null, (categoryid && !discardFoodCategory) ? [categoryid] : null);\n            this.foodsWithCats = this.generateFoodWithCats(this.foods)\n        } else {\n            this.foods = await new ProductsApi(this.constructorParams).getTarifResources(null, null, categoryid ? [categoryid] : null);\n            this.foodsWithCats = this.generateFoodWithCats(this.foods)\n        }\n    }\n\n    @Auth.Anonymous()\n    async foodsAndTarifsRoute() {\n        this.foodCategory = this.req.query.tab as string;\n        if (this.foodCategory == 'tarifler') {\n            await this.fillTarifs();\n        } else if (this.foodCategory == 'yemekler') {\n            await this.fillFoods();\n        } else await this.fillFoodsAndTarifs();\n\n\n        this.sendView('pages/foods.ejs', {\n            pageTitle: 'Et Yemekleri ve Tarifleri'\n        })\n    }\n\n    @Auth.Anonymous()\n    async viewTarifsRoute() {\n        if (this.req.params.category) {\n            this.category = this.req.__categories.find(p => p.slug == this.req.params.category);\n\n            if (!this.category) return this.next();\n            //await this.fillTarifs(this.req.params.category)\n        } else {\n            await this.fillTarifs();\n        }\n\n        this.res.render('pages/tarifs.ejs', this.viewData({\n            pageTitle: 'Et Yemek Tarifleri'\n        }))\n    }\n\n\n\n\n    @Auth.Anonymous()\n    async viewAsFoodAndTarifRoute(back: boolean = false) {\n        if (!this.req.params.category) {\n            return this.next();\n        }\n        this.category = this.req.__categories.find(p => p.slug == this.req.params.category);\n        if (!this.category) return this.next();\n\n        this.foodCategory = this.req.query.tab as string;\n\n        if (this.category.type == 'resource') {\n            if (this.foodCategory == 'tarifler') {\n                await this.fillTarifs(this.category.id);\n            } else if (this.foodCategory == 'yemekler') {\n                await this.fillFoods(this.category.id);\n            } else await this.fillFoodsAndTarifs(this.category.id);\n            this.renderPage('pages/category-food.ejs')\n        } else {\n            if (this.foodCategory == 'tarifler') {\n                await this.fillTarifs(this.category.id, this.category.slug, true);\n            } else if (this.foodCategory == 'yemekler') {\n                await this.fillFoods(this.category.id, this.category.slug, true);\n            } else await this.fillFoodsAndTarifs(this.category.id, this.category.slug, true);\n\n            this.renderPage('pages/category-sub-food.ejs', true)\n        }\n    }\n\n\n\n    @Auth.Anonymous()\n    async viewProductCategoryRoute(back: boolean = false) {\n        if (!this.req.params.category) {\n            return this.next();\n        }\n        this.category = this.req.__categories.find(p => p.slug == this.req.params.category);\n        if (!this.category) return this.next();\n\n        if (this.category.type == 'resource') {\n            this.res.redirect('/et-yemekleri/' + this.category.slug, 301);\n            //await this.fillFoods(this.category.id, this.req.params.subcategory);\n            //this.renderPage('pages/category-food.ejs')\n        }\n\n        else {\n            this.products = await ProductManager.getProductsOfCategories([this.category.id]);\n\n            this.subCategories = ProductManager.generateSubcategories(this.category, this.products);\n\n\n            if (this.category.relatedFoodCategory) {\n                this.foods = await new ProductsApi(this.constructorParams).getFoodAndTarifResources(null, null, [this.category.relatedFoodCategory]);\n\n            } else if (this.category.tarifTitle) {\n                this.foods = await new ProductsApi(this.constructorParams).getFoodAndTarifResources(this.products, 15);\n            }\n            this.renderPage('pages/category.ejs')\n        }\n    }\n\n    @Auth.Anonymous()\n    async categoryPhotoRoute() {\n        if (!this.req.params.category || !this.req.params.filename) return this.next();\n        let category = this.req.__categories.find(p => p.slug == this.req.params.category);\n        if (!category)\n            return this.next();\n\n        let photo: ResourceCacheItem, thumbnail = false, url = \"\";\n\n        let res = new ResourceRoute({\n            req: this.req,\n            res: this.res,\n            next: this.next\n        })\n\n        let type = \"category-photos\";\n        let defaultFile = \"public/img/category-default-thumbnail.jpg\";\n\n        if (this.req.params.filename == \"thumbnail\") {\n            thumbnail = true;\n            photo = this.req.helper.getResourcesOfType(type + category.id).find(p => p.ref1 == category.id)\n        }\n        else photo = this.req.helper.getResourcesOfType(type + this.req.params.filename).find(p => p.contentUrl == this.req.params.filename);\n        res.sendResource(photo, thumbnail, thumbnail ? defaultFile : null)\n    }\n\n\n    static SetRoutes(router: express.Router) {\n        router.get(\"/:category\", Route.BindRequest(Route.prototype.viewProductCategoryRoute));\n        router.get(\"/:category/et-yemekleri\", Route.BindRequest(Route.prototype.viewAsFoodAndTarifRoute));\n        router.get(\"/et-yemekleri\", Route.BindRequest(Route.prototype.foodsAndTarifsRoute));\n        router.get(\"/et-yemekleri/:category\", Route.BindRequest(Route.prototype.viewAsFoodAndTarifRoute));\n\n\n\n\n        // router.get(\"/et-yemek-tarifleri\", Route.BindRequest(Route.prototype.viewTarifsRoute));\n\n        // router.get(\"/et-yemek-tarifleri/kategori/:category\", Route.BindRequest(Route.prototype.viewTarifsRoute));\n\n\n\n\n        //router.get(\"/et-yemekleri/kategori/:category\", Route.BindRequest(Route.prototype.viewFoodsRoute));\n        config.nodeenv == 'development' ? router.get(\"/:category/resimler/:filename\", Route.BindRequest(Route.prototype.categoryPhotoRoute)) : null;\n\n    }\n}"],"sourceRoot":"../../src/"}