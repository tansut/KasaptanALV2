{"version":3,"sources":["../src/lib/commissionHelper.ts"],"names":[],"mappings":"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","file":"commissionHelper.js","sourcesContent":["import * as Jimp2 from 'jimp'\nimport * as path from \"path\"\nimport * as numeral from 'numeral';\nimport moment = require('moment');\nimport { AppRequest } from './http';\nimport config from '../config';\nimport { GeoLocation } from '../models/geo';\nimport { create } from 'domain';\nimport Helper from './helper';\nimport { Puan } from '../models/puan';\nimport AccountModel from '../db/models/accountmodel';\nimport { Account } from '../models/account';\n\nexport interface ComissionResult {\n    inputRate: number;\n    inputFee: number;\n    inputTotal: number;\n    product: number;\n    productVat: number;\n    kalitteFee: number;\n    kalitteVat: number;    \n    butcherVatAdvantage: number;\n    butcherTaxAdvantage: number;\n    butcherBankFeeAdvantage: number;\n    butcherNetCost: number;\n    butcherToCustomer: number;\n}\n\nexport class ComissionHelper {\n\n   constructor(public rate: number, public fee: number, public butcherBankRate=0.012) {\n\n   }\n\n   calculateButcherComission(totalSales: number, puan: Puan = null): ComissionResult {\n       let product = Helper.asCurrency(totalSales / 1.08);\n       let productVat = Helper.asCurrency(totalSales - product);\n       let kalitteFee = Helper.asCurrency(product * this.rate + this.fee);\n       let kalitteVat = Helper.asCurrency(kalitteFee * 0.18);\n        return {\n            inputRate: this.rate,\n            inputTotal: totalSales,\n            inputFee: this.fee,\n            product: product,\n            productVat: productVat,\n            kalitteFee: kalitteFee,\n            kalitteVat: kalitteVat,\n            butcherBankFeeAdvantage: Helper.asCurrency(totalSales * this.butcherBankRate),\n            butcherTaxAdvantage: Helper.asCurrency(kalitteFee * 0.22),\n            butcherVatAdvantage: Helper.asCurrency(kalitteVat),\n            butcherNetCost: Helper.asCurrency(kalitteFee - kalitteFee * 0.22 - Helper.asCurrency(totalSales * this.butcherBankRate)),\n            butcherToCustomer: puan ? new PuanCalculator().calculateCustomerPuan(puan, totalSales): 0.00\n        }\n   }\n\n}\n\nexport class PuanCalculator {\n\n    calculateCustomerPuan(puan: Puan, totalSales: number) {\n        if (Helper.asCurrency(puan.minSales) == 0.00 || (totalSales >= puan.minSales)) {\n            return Helper.asCurrency(totalSales * puan.rate)\n        } else return 0.00\n    }\n\n    async earnedButcherPuanAccounts(userid: number, butcherid: number) {\n        return await AccountModel.summary([Account.generateCode(\"musteri-kasap-kazanilan-puan\", [userid, butcherid])]);\n    }\n\n    async getEarnedButcherPuan(userid: number, butcherid: number) {\n        let summary = await this.earnedButcherPuanAccounts(userid, butcherid)\n        return Helper.asCurrency(summary.alacak - summary.borc);\n    }  \n    \n    async earnedKalittePuanAccounts(userid: number, butcherid: number) {\n        return await AccountModel.summary([\n            Account.generateCode(\"musteri-kalitte-kazanilan-puan\", [userid, 1]),\n            Account.generateCode(\"musteri-kalitte-kazanilan-puan\", [userid, 2])]);\n    }\n\n    async getEarnedKalittePuan(userid: number, butcherid: number) {\n        let summary = await this.earnedKalittePuanAccounts(userid, butcherid)\n        return Helper.asCurrency(summary.alacak - summary.borc);\n    }      \n\n}"],"sourceRoot":"../../src/"}