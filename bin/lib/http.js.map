{"version":3,"sources":["../src/lib/http.ts"],"names":[],"mappings":";AAAA,qDAAqD;;;AAWrD,MAAa,gBAAiB,SAAQ,KAAK;IACvC,YAAsB,OAAgB;QAClC,KAAK,CAAC,OAAO,CAAC,CAAC;IACnB,CAAC;CACJ;AAJD,4CAIC;AAED,MAAa,aAAc,SAAQ,gBAAgB;IAC/C,YAAsB,OAAgB;QAClC,KAAK,CAAC,OAAO,CAAC,CAAC;IACnB,CAAC;CACJ;AAJD,sCAIC;AAED,MAAa,aAAc,SAAQ,gBAAgB;IAC/C,YAAsB,OAAgB;QAClC,KAAK,CAAC,OAAO,CAAC,CAAC;IACnB,CAAC;CACJ;AAJD,sCAIC;AAED,MAAa,SAAU,SAAQ,gBAAgB;IAI3C,YAA6B,UAAkB,EAAE,OAAgB;QAC7D,KAAK,CAAC,OAAO,CAAC,CAAC;QADU,eAAU,GAAV,UAAU,CAAQ;IAE/C,CAAC;IAED,MAAM,CAAC,iBAAiB,CAAC,GAAQ,EAAE,QAAmC;QAClE,IAAI,IAAI,GAAG,GAAG,CAAC,IAAI,EAAE,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,wBAAwB,CAAC;QACvG,OAAO,IAAI,SAAS,CAAC,GAAG,EAAE,SAAS,CAAC,CAAA;IACxC,CAAC;;AAXL,8BAYC;AAXU,sBAAY,GAAG;IAClB,KAAK,EAAE,qDAAqD;CAC/D,CAAA;AAYL,MAAa,eAAgB,SAAQ,SAAS;IAC1C,YAAY,GAAY;QACpB,KAAK,CAAC,GAAG,EAAE,GAAG,IAAI,cAAc,CAAC,CAAC;IACtC,CAAC;CACJ;AAJD,0CAIC;AAED,MAAa,aAAc,SAAQ,SAAS;IACxC,YAAY,GAAY;QACpB,KAAK,CAAC,GAAG,EAAE,GAAG,IAAI,UAAU,CAAC,CAAC;IAClC,CAAC;CACJ;AAJD,sCAIC;AAED,MAAa,eAAgB,SAAQ,SAAS;IAC1C,YAAY,GAAW,EAAE,OAAa,GAAG;QACrC,KAAK,CAAC,IAAI,EAAE,GAAG,IAAI,aAAa,CAAC,CAAC;IACtC,CAAC;CACJ;AAJD,0CAIC","file":"http.js","sourcesContent":["// import { IUserDocument } from '../db/models/user';\n\nimport * as express from 'express';\nimport User, { PreferredAddress } from '../db/models/user';\nimport { ShopCard } from '../models/shopcard';\nimport { RequestHelper } from './RequestHelper';\nimport Category from '../db/models/category';\nimport { ResourceCacheItem, ProductCacheItem, CategoryProductItem, ButcherCacheItem, WebPageCacheItem, RedirectCacheItem } from './cache';\nimport Content from '../db/models/content';\nimport PriceCategory from '../db/models/pricecategory';\n\nexport class ApplicationError extends Error {\n    protected constructor(message?: string) {\n        super(message);\n    }\n}\n\nexport class BusinessError extends ApplicationError {\n    protected constructor(message?: string) {\n        super(message);\n    }\n}\n\nexport class TehnicalError extends ApplicationError {\n    protected constructor(message?: string) {\n        super(message);\n    }\n}\n\nexport class HttpError extends ApplicationError {\n    static dbErrorCodes = {\n        11000: 'It seems there already exists a record with this id'\n    }\n    protected constructor(public statusCode: number, message?: string) {\n        super(message);\n    }\n\n    static createFromDbError(err: any, overides: { [key: number]: string }) {\n        var code = err.code, errorText = overides[code] || this.dbErrorCodes[code] || 'Unknown database error';\n        return new HttpError(500, errorText)\n    }\n}\n\n\nexport class PermissionError extends HttpError {\n    constructor(msg?: string) {\n        super(401, msg || 'unauthorized');\n    }\n}\n\nexport class NotFoundError extends HttpError {\n    constructor(msg?: string) {\n        super(404, msg || 'notfound');\n    }\n}\n\nexport class ValidationError extends HttpError {\n    constructor(msg: string, code: number=422) {\n        super(code, msg || 'invaliddata');\n    }\n}\n\nexport interface AppRequest extends express.Request {\n    user: User;\n    session: any;\n    helper: RequestHelper;\n    prefAddr: PreferredAddress;\n    __categories: Category[];\n    __pricecategories: PriceCategory[];\n    __resources: { [key: string]: [ResourceCacheItem]; }\n    __products: { [key: string]: ProductCacheItem; }\n    __recentBlogs: Content[];\n    __categoryProducts: { [key: string]: CategoryProductItem[]; }\n    __butchers: { [key: string]: ButcherCacheItem; }\n    __webpages: { [key: string]: WebPageCacheItem; }\n    __redirects: { [key: string]: RedirectCacheItem; }\n\n}\n "],"sourceRoot":"../../src/"}