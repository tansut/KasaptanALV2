{"version":3,"sources":["../src/lib/payment/iyzico.ts"],"names":[],"mappings":"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","file":"iyzico.js","sourcesContent":["import {PaymentRequest, CreditcardPaymentProvider, CreditcardPaymentFactory, PaymentResult, Creditcard, SubMerchantCreateRequest, SubMerchantCreateResult, SubMerchantItemApproveRequest, SubMerchantItemApproveResponse } from \"./creditcard\";\n\nvar Iyzipay = require('iyzipay');\n\nexport interface IyzicoConfig {\n    apiKey: string,\n    secretKey: string,\n    uri: string;\n}\n\nexport default class IyziPayment extends CreditcardPaymentProvider {\n    static key = \"iyzico\";\n    private iyzipay: any;\n\n\n    constructor(config: IyzicoConfig) {\n        super(config);\n        this.iyzipay = new Iyzipay(config);\n    }\n\n    createIyzicoPaymentReq(request: PaymentRequest, card: Creditcard) {\n        let req = <any>request;\n        req.paymentCard = card;\n        return req;\n    }\n\n    get providerKey() {\n        return IyziPayment.key\n    }\n\n    async approveItem(request: SubMerchantItemApproveRequest): Promise<SubMerchantItemApproveResponse> {\n        return new Promise((resolve, reject) => {\n            this.iyzipay.approval.create(request, (err, result) => {\n                this.logOperation(\"submerchant-approval\", request, result).then(() => {\n                    if (err) reject(err);\n                    else if (result.status == 'failure') reject(result);\n                    else resolve(result);\n                }).catch(err=>reject(err))\n            });\n        })        \n    }    \n\n    async disApproveItem(request: SubMerchantItemApproveRequest): Promise<SubMerchantItemApproveResponse> {\n        return new Promise((resolve, reject) => {\n            this.iyzipay.disapproval.create(request, (err, result) => {\n                this.logOperation(\"submerchant-disapproval\", request, result).then(() => {\n                    if (err) reject(err);\n                    else if (result.status == 'failure') reject(result);\n                    else resolve(result);\n                }).catch(err=>reject(err))\n            });\n        })          \n    }     \n\n    async pay3dInit(request: PaymentRequest, card: Creditcard): Promise<PaymentResult> {\n        let req = this.createIyzicoPaymentReq(request, card);\n        \n        return new Promise((resolve, reject) => {\n            this.iyzipay.threedsInitialize.create(req, (err, result) => {\n                this.logOperation(\"creditcard-3d-init\", request, result).then(() => {\n                    if (err) reject(err);\n                    else if (result.status == 'failure') reject(result);\n                    else {\n                        let buff = new Buffer(result.threeDSHtmlContent, 'base64');\n                        result.threeDSHtmlContent = buff.toString('ascii');\n                    } resolve(result);\n                }).catch(err=>reject(err))\n            });\n        })\n    }\n\n    async pay3dHandshakeSuccess(result: any) {\n        result = result || {};\n        if (result.mdStatus == \"1\" && result.status == 'success') return true;\n        else {\n            await this.logOperation(\"3d-handshake-fail\", result, {})\n            return false;      \n        }   \n    }\n\n    async pay3dComplete(request: any): Promise<PaymentResult> {        \n        let req = request;\n        return new Promise((resolve, reject) => {\n            this.iyzipay.threedsPayment.create(req, (err, result) => {\n                this.logOperation(\"creditcard-3d-complete\", request, result).then(() => {                    \n                    if (err) reject(err);\n                    else if (result.status == 'failure') reject(result);\n                    else return this.savePayment(\"3d-iyzico\", request, result).then(()=>resolve(result)).catch(err=>reject(err));\n                }).catch(err=>reject(err))\n            });\n        })\n    }\n\n\n    async pay(request: PaymentRequest, card: Creditcard): Promise<PaymentResult> {\n        let req = this.createIyzicoPaymentReq(request, card);\n        \n        return new Promise((resolve, reject) => {\n            this.iyzipay.payment.create(req, (err, result) => {\n                this.logOperation(\"creditcard-payment-create\", request, result).then(() => {\n                    if (err) reject(err);\n                    else if (result.status == 'failure') reject(result);\n                    else return this.savePayment('pos-iyzico', request, result).then(()=>resolve(result)).catch(err=>reject(err));                    \n                }).catch(err=>reject(err))\n            });\n        })\n    }\n\n    async createSubMerchant(request: SubMerchantCreateRequest): Promise<SubMerchantCreateResult> {\n        return new Promise((resolve, reject) => {\n            this.iyzipay.subMerchant.create(request, (err, result) => {\n                this.logOperation(\"submerchant-create\", request, result).then(() => {\n                    if (err) reject(err);\n                    else if (result.status == 'failure') reject(result);\n                    else resolve(result);\n                }).catch(err=>reject(err))\n            });\n        })\n    }\n\n\n    static register() {\n        CreditcardPaymentFactory.register(IyziPayment.key, IyziPayment)\n    }\n} "],"sourceRoot":"../../../src/"}