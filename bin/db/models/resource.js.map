{"version":3,"sources":["../src/db/models/resource.ts"],"names":[],"mappings":"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","file":"resource.js","sourcesContent":["import { Table, Column, DataType, Model, HasMany, CreatedAt, UpdatedAt, DeletedAt, Unique, Default, AllowNull } from 'sequelize-typescript';\nimport BaseModel from \"./basemodel\"\nimport Helper from '../../lib/helper';\nimport Product from './product';\nimport ResourceCategory from './resourcecategory';\nimport config from '../../config';\nimport { ResourceView } from '../../models/productView';\n\n@Table({\n    tableName: \"Resources\",\n    indexes: [{\n        name: \"type_ref1_idx\",\n        fields: [\"type\", \"ref1\"]\n    },\n    {\n        name: \"type_ref2_idx\",\n        fields: [\"type\", \"ref2\"]\n    },\n    {\n        name: \"type_ref3_idx\",\n        fields: [\"type\", \"ref3\"]\n    },\n\n    {\n        name: \"type_ref4_idx\",\n        fields: [\"type\", \"ref4\"]\n    },\n\n    {\n        name: \"type_ref5_idx\",\n        fields: [\"type\", \"ref5\"]\n    },\n\n    {\n        name: \"type_ref6_idx\",\n        fields: [\"type\", \"ref6\"]\n    },\n\n    {\n        name: \"slug_idx\",\n        fields: [\"slug\"],\n        unique: true\n    },\n    {\n        name: \"type_content_idx\",\n        fields: [\"type\", \"contentUrl\"]\n    },\n    \n    { type: 'FULLTEXT', name: 'resource_fts', fields: ['title', 'description', 'slug', 'keywords'] }]\n\n\n})\nclass Resource extends BaseModel<Resource> {\n\n    product: Product;\n\n    otherProducts: Product[] = [];\n\n    @Column\n    keywords: string;    \n\n    @HasMany(() => ResourceCategory, {\n        sourceKey: \"id\",\n        foreignKey: \"resourceid\"\n    })\n    categories: ResourceCategory[];\n\n    @Column({\n        allowNull: false,\n    })\n    type: string;\n\n    @Column({\n        allowNull: true\n    })\n    slug: string;\n\n    @Column({\n        allowNull: false,\n        defaultValue: true\n    })\n    list: boolean;\n\n    @Column({\n        allowNull: true,\n        type: DataType.TEXT\n    })\n    mddesc: string;    \n\n\n    @Column({\n        allowNull: true\n    })\n    w: string;    \n\n    @Column({\n        allowNull: true\n    })\n    h: string;     \n\n    @Column({\n        allowNull: false,\n    })\n    ref1: number;\n\n    @Column\n    ref2: number;\n\n    @Column\n    ref3: number;\n\n    @Column\n    ref4: number;\n\n    @Column\n    ref5: number;\n\n    @Column\n    ref6: number;    \n\n    @Column\n    contentType: string;\n\n    @Column\n    contentLength: number\n\n    @Column\n    title: string;\n\n    @Column\n    contentUrl: string;\n\n    @Column\n    thumbnailUrl: string;\n\n    @Column\n    isdefault: boolean\n\n    @Column\n    displayOrder: number\n\n    @Column\n    folder: string;\n\n    @Column\n    tag1: string;\n\n    @Column\n    tag1Desc: string;\n\n    @Column\n    tag2: string;\n\n    @Column\n    tag2Desc: string;\n\n    @Column\n    tag3: string;\n\n    @Column\n    tag3Desc: string;\n\n    @Column\n    badge: string;\n\n    @Column\n    description: string;\n\n    // get note() {\n    //     let note = this.tag2;\n    //     if (this.tag1 && this.tag1.includes('tarif')) {\n    //         note = this.tag2 || (`${this.title} yapacağım, lütfen uygun hazırlayın.`);\n    //     } else if (this.tag1 == 'hazirlama-sekli') {\n    //         note = this.tag2 ? (this.tag2) : (this.title + \" olarak hazırlayın.\")\n    //     } else if (this.tag1 && this.tag1.includes('yemek')) {\n    //         note = this.tag2 || (`${this.title} yapacağım, lütfen uygun hazırlayın.`);\n    //     }\n\n\n    //     return note\n    // }\n\n    @Column({\n        type: DataType.TEXT\n    })\n    settingsjson: string\n\n    get settings(): any {\n        return this.settingsjson ? JSON.parse(this.getDataValue('settingsjson')) : null\n    }\n\n    set settings(value: any) {\n        this.setDataValue('settingsjson', JSON.stringify(value));\n    }\n\n    asView(): ResourceView {\n        return {\n            id: this.id,\n            title: this.title,\n            tag1: this.tag1,\n            // thumbnailUrl: (this.thumbnailUrl ? this.thumbnailFileUrl: null) ||  `${Helper.imgUrl('product-photos', this.product.slug)}` ,\n            thumbnailUrl: this.thumbnailFileUrl,\n            settings: this.settingsByRef\n        }\n    }\n\n     getRef(id: number): number {\n        if (this.product) {\n            if (this.ref1 == id) return 1;\n            if (this.ref2 == id) return 2;\n            if (this.ref3 == id) return 3;\n            if (this.ref4 == id) return 4;\n            if (this.ref5 == id) return 5;\n            if (this.ref6 == id) return 6;\n        } else return 0;\n    }\n\n    getSettingsByRefId(id: number) {\n            let settings = this.settings || {};\n            return settings[`ref${this.getRef(id)}`]\n    }\n\n    get settingsByRef(): any {\n        if (this.product) {\n            return this.getSettingsByRefId(this.product.id) || this.settings || {}\n        } else return {};\n    }\n\n    get fileUrl() {\n        return this.getFileUrl()\n    }\n\n    get thumbnailFileUrl() {\n        return this.getThumbnailFileUrl();\n    }\n\n    getFileUrl() {\n        if (this.contentType == 'image/jpeg')\n            return `${config.staticDomain}/${this.folder}/${this.contentUrl}`\n        else return `https://www.youtube.com/watch?v=${this.contentUrl}`;\n    }\n\n    getThumbnailFileUrl(ignoreThumbnail: boolean = false) {\n        if (this.contentType == 'image/jpeg') {\n            return `${config.staticDomain}/${this.folder}/${this.thumbnailUrl}`\n        } else if (this.thumbnailUrl && !ignoreThumbnail) {\n            return `${config.staticDomain}${this.thumbnailUrl}`\n        } else return `https://img.youtube.com/vi/${this.contentUrl}/maxresdefault.jpg`\n    }\n}\n\nexport default Resource;"],"sourceRoot":"../../../src/"}