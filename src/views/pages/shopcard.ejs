<!DOCTYPE html>
<html lang="tr-TR" prefix="og: http://ogp.me/ns#">

<head>
  <% include ./_partial/head %>
  <meta name="robots" content="noindex,follow">

</head>

<body>
  <% include ./_partial/header %>




  <div class="page-title py-2">
    <div class="container d-lg-flex justify-content-between py-2 py-lg-3">
      <div class="order-lg-2 mb-3 mb-lg-0 pt-lg-2">
        <nav aria-label="breadcrumb" class="d-none d-lg-block">
          <ol class="breadcrumb breadcrumb-dark flex-lg-nowrap justify-content-center justify-content-lg-star">
            <li class="breadcrumb-item"><a class="text-nowrap" href="/"><i class="czi-home"></i></a></li>
                   </ol>
        </nav>
      </div>
      <div class="order-lg-1 pr-lg-4 text-center text-lg-left">
        <h1 class="h3">Sepetim</h1>
        <h2 class=" h4 lead"></h2>
      </div>
    </div>
  </div>

  <%
  
  var showShopBtn = true;
  
  %>
  <form method="POST" onsubmit="return App.Auth.checkAuthentication('/alisveris-sepetim/ship', '<h6>Muazzam ürünler!</h6><p>Şimdi <b>en fazla 2 dakikada</b> alışverişinizi tamamlayın.</p>')" novalidate
    class="needs-validation" action="/alisveris-sepetim/savecard">
    <div class="container mb-3 ">


      <div class="row">

        <section class="col-lg-8">
    
          <div class="">
    
    
            
    
    

    
    
            <% var partners = controller.Butchers.filter(p=>p.enablePuan) %>
          
            <% if (controller.mayEarnPuanTotal + controller.usablePuanTotal > 0.00) { %>
              <h5 class="h5">
                Kazançlar
              </h5>
            <% } %>
            <% if (controller.possiblePuanList.length > 0) { %>
            <div class="mb-3 bg-secondary text-success border p-3">
    
              <h6 class="h6">Kasap Kart&trade; Puan Kazancı</h6>


                <% controller.possiblePuanList.forEach(pg => { %>
                <ul>
                  <li>
    
                    <strong  class="font-weight-bold <%=pg.earned <= 0.00 ? 'text-danger':'text-success'%>"><%- include('./_partial/currency.ejs', {value: pg.earned}) %></strong>
                    <span class="text-dark"><%= pg.title%></span> 
                    <% if (pg.earned <= 0.00) {%>
                    <% showShopBtn = true%>
                    <% if (pg.earned <= 0.00) { %>
                    <div class="text-dark font-size-sm">  
                        <% 
                        var butcherTotal = shopcard.getButcherTotalWithoutShipping(parseInt(pg.id));
                        var puanButcher = shopcard.butchers[pg.id];
                        var more = __helper.asCurrency(pg.based.minSales - butcherTotal)
                        %>                   
                        
                        
                        Bu kasabımızdan <strong><%- include('./_partial/currency.ejs', {value: more}) %> daha </strong> alışveriş yapın,  <strong>                  
                                    
                      <%- include('./_partial/puan-data-view.ejs', {puan: pg.based, hideMinPuanForUsage: true, hideMinSales: true}) %></strong>   
                      
                    
    
    
                    </div>
                    <a class="font-size-sm" href="/kasap-urunleri">
                      <i class="czi-arrow-right-circle mr-2"></i>
                      Ürünlere Gözatın</a>
                    <%}%>       
    
                    <% } %>
                  </li>
                </ul>
    
    
                <% }) %>
                <% if (controller.possiblePuanList.length > 1 && controller.mayEarnPuanTotal > 0.00) { %>
                <span class="text-dark d-block">
                  Toplam
                  <strong><%- include('./_partial/currency.ejs', {value: controller.mayEarnPuanTotal}) %></strong>
                  değerinde yeni puanı hesabınıza yüklüyoruz.
                </span>
                <% } else if (!__req.user) { %>
               
                <% } %>
             
            </div>
            <%}%>

            <% if (controller.usablePuanTotal > 0.00) { %>
              <div class="mb-3 bg-secondary border p-3">
                <h6 class="h6">Kullanılabilir Puanlarınız</h6>

<ul>
  <li>
    <strong class="text-success"><%- include('./_partial/currency.ejs', {value: controller.usablePuanTotal}) %></strong> puanınız bu siparişinizde kullanılabilir.
  </li>
</ul>
                <span class="text-muted font-size-sm d-block">
                 
                  Online ödeme aşamasında puanınızı toplam tutardan düşebilirsiniz. 
                </span>
              </div>
              <% } else { %>
                   <div class="mb-3 bg-secondary border p-3">
                     <h5 class="h5">Mevcut Puanlarınızı Görüntüleyin</h5>

                    <p>
                      Önceki siparişlerinizden kazandığınız puanları görüntülemek için giriş yapın.
                    </p>
                    <button type="button" onclick="App.showLoginDlg('/alisveris-sepetim')" class="btn btn-dark"><i class="czi-user text-white"></i> Giriş Yap</button>
                    
                  </div>
              <% } %>
           

 
    
        
       
         <% if (!shopcard.items.length) { %>
      
            <div class="text-center">
              <a class="btn btn-sm btn-primary" href="/kasap-urunleri">Alışverişe Başla<i
                  class="czi-arrow-right ml-2 mr-n1"></i></a>
    
    
            </div>
            <% } else { %>
              <h5 class="h5">
                Ürünler
              </h5>
            <%- include('./_partial/shopcardlist.ejs', {
          shopcard: shopcard,
          enableRemove: true
        }) %>

        <% } %>
          </div>

          <div class="text-center">
            <% if (shopcard.items.length) { %>
            <% if (showShopBtn) { %>
              <div class="text-center mb-3">
                <p>
                  Alacaklarınız mı var?
                </p>
                <a class="btn btn-primary" href="/kasap-urunleri">Alışverişe Devam</a>

              </div>
            <% } %>
    
    
       
            <%} else { %>
    
            <%}%>
          </div>

        </section>
    
        <aside class="col-lg-4">


          <div class="ml-lg-auto">
      
            
              <div class="accordion mb-4" id="order-options">
      
                  <div class="card">
                      <div class="card-header ">
                          <h3 class="accordion-heading"><a class="" href="#order-discounts" role="button"
                                  data-toggle="collapse" aria-expanded="true" aria-controls="order-discounts">Toplamlar<span
                                      class="accordion-indicator"></span></a></h3>
                      </div>
                    
                      <div class="collapse show" id="order-discounts" data-parent="#order-options">
                        <div class="card-body">
                            <div class="text-center">
                               <p>
                                Ürünler Toplamı
                               </p>
                               <p class="font-weight-bold">
                                <%- include('./_partial/currency.ejs', {value: shopcard.subTotal}) %>

                               </p>
                                <% if (shopcard.discountTotal != 0) { %>
                                <br>
                                <span class="text-muted">
                                    <del><%- include('./_partial/currency.ejs', {value: shopcard.subTotal}) %> </del>
        
                                </span>
                                <% } %>
                            </div>
                            <% if (controller.mayEarnPuanTotal > 0.00) { %>
                            <div class="text-center">
                                <p>
                                  Kasap Kart&trade; Puan Kazancı
                                </p>
                                <p class="font-weight-bold text-success">
                                    <%- include('./_partial/currency.ejs', {value: controller.mayEarnPuanTotal}) %>
        
                                </p>
                            </div>
                            <% } %>

                            <% if (controller.usablePuanTotal > 0.00) { %>
                              <div class="text-center">
                                <p>
                                    Düşebileceğiniz Tutar
                                </p>
                                <p class="font-weight-bold text-success">
                                    <%- include('./_partial/currency.ejs', {value: controller.usablePuanTotal}) %>
        
                                </p>
                            </div>
                            <% }%>

                            <% if (controller.mayEarnPuanTotal > 0.00 && controller.usablePuanTotal > 0.00) { %>
                              <div class="text-center bg-secondary border p-3">
                                  <p>
                                     Toplam Kazancınız
                                  </p>
                                  <p class="font-size-lg text-success font-weight-bold">
                                      <%- include('./_partial/currency.ejs', {value: controller.mayEarnPuanTotal + controller.usablePuanTotal}) %>
          
                                  </p>
                              </div>
        
                            <% } %>
        
                        </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header ">
                        <h3 class="accordion-heading"><a class="" href="#order-ship" role="button"
                                data-toggle="collapse" aria-expanded="true" aria-controls="order-ship">Teslimat<span
                                    class="accordion-indicator"></span></a></h3>
                    </div>
                  
                    <div class="collapse" id="order-ship" data-parent="#order-ship">
                      <div class="card-body font-size-xs text-muted text-center">
                          <% for(var o in shopcard.shipment) { %>
                          
                            <% if (controller.destinationMatrix[o] && controller.destinationMatrix[o].provider) { %>
                              <div class="text-center mb-3">
                                <%=shopcard.butchers[o].name  %> <br>
                                <div class="font-size-sm text-muted">
                                  <%= controller.destinationMatrix[o].provider.name %>

                                </div>
                              </div>
                           
                              <div class="mb-2">
                                <%- include('./_partial/ship-price-slice.ejs', {                                
                                  slices: controller.destinationMatrix[o].slices,
                                  total: shopcard.butchers[o].subTotal
                                    }) %>
                              </div>
    
                            <% } %>


                        
                          <% } %>

      
                      </div>
                  </div>
                </div>
              
              </div>
      
              <% if (shopcard.items.length > 0) { %>
             <button data-tag="true" data-category="checkout" data-action="view/start"
                  data-label="<%=__req.user ? __req.user.mphone: ''  %>" data-value="<%=shopcard.items.length%>"
                  class="btn btn-dark btn-block mt-4  " type="submit" value="true" name="checkout" id="checkout">Alışverişimi Tamamla</button> 
      
      <%}%>
              
          </div>
      
      
      </aside>
      </div>


      
    </div>
  </form>


  <% include ./_partial/footer %>
  <% include ./_partial/scripts %>

  <script>
    window.App.gTag('checkout', 'view/shopcard', "<%=__req.user ? __req.user.mphone: ''  %>", <%=shopcard.items.length %>);
    
    <% Object.keys(shopcard.butchers).forEach(item => { %>
      window.App.gTag('checkout', 'view/shopcard/butcher', "<%=shopcard.butchers[item].slug%>", 1);
    <%}) %>

    <% shopcard.items.forEach(item => { %>
        window.App.gTag('checkout', 'view/shopcard/item', "<%=item.product.slug%>", 1);
    <%}) %>

    
  </script>

</body>

</html>