<!DOCTYPE html>
<html lang="tr-TR" prefix="og: http://ogp.me/ns#">

<head>
  <% include ./_partial/head %>
  <% if (controller.productLd) { %>
  <script type="application/ld+json">
    <%- JSON.stringify(controller.productLd) %>
  </script>

  <% } %>
  <script>
    var gtags = [];
  </script>
  
  <% if (Object.keys(__req.query).length != 0 ) {%>
  <meta name="robots" content="noindex,follow">
  <link href="https://www.kasaptanal.com<%=__req.path%>" rel="canonical">
  <%}%>
</head>

<body>

  <%if (__req.query.frame != '1') { %> 
  <% include ./_partial/header %>
  <%}%>

  <%- include('./_partial/product-weight-calc.ejs', {    product: product}) %>

  <% otherButcherAlternatives = butchers.serving.length  + butchers.takeOnly.length - 1 %>


  <%if (__req.query.frame != '1') { %>
  <div  class=" page-title py-2">
    <div class="container d-lg-flex justify-content-between py-2 py-lg-3">
      <div class="order-lg-2 mb-3 mb-lg-0 pt-lg-2">
        
        <nav aria-label="breadcrumb" class="d-none d-lg-block">
          <ol class="breadcrumb breadcrumb-dark flex-lg-nowrap justify-content-center justify-content-lg-star">
            <li class="breadcrumb-item"><a class="text-nowrap" href="/"><i class="czi-home"></i></a></li>
            <li class="breadcrumb-item text-nowrap"><a href="/kasap-urunleri">Ürünler</a>
            </li>
          </ol>
        </nav>
        
      </div>
      <div class="order-lg-1 pr-lg-4 text-center text-lg-left">
        <h1 class="h3"><%= view.name %></h1>
        <h2 class="lead h4"><%= view.shortDesc %></h2>
        <% if (__req.user && __req.user.hasRole('admin')) {%>
        <a target="_blank" class="btn btn-dark btn-sm" href="/pages/admin/product/<%=product.slug%>">Düzenle
          <%=product.id%></a>
        <%}%>
      </div>
    </div>
  </div> 

  <% } %>

  <%
  let resources = product.resources.filter(r=>r.list == true); 
  let images = resources.filter(p=>p.contentType == "image/jpeg");
  let videos = resources.filter(p=>p.contentType == "video-youtube");
  let tarifs = resources.filter(p=>p.tag1 && p.tag1.includes("tarif"));
  let tarifsAndFoods = resources.filter(p=>p.tag1 && (p.tag1.includes("tarif") || p.tag1.includes("yemek")));
  nonDisplayedResources  = resources.filter(resource=> (resource.tag1 && resource.tag1.includes('yemek') && resource.ref1 != product.id))
  let videoTarifs = tarifs.filter(p=>p.contentType == "video-youtube");
  let hazirlanisResources = resources.filter(p=>p.tag1 == "hazirlama-sekli");
  let bilgiResources = resources.filter(p=>p.tag1 == "bilgi");
  let otherVideos = videos.filter(p=>(p.tag1 && !p.tag1.includes( "tarif") && p.tag1 != "hazirlama-sekli" ));
  let firstImage = images.length ? images[0]: null;  
  let chunks = _.chunk(images.slice(1, images.length), 3)
  let alternativeimages = images.slice(1, images.length)
  var butcherVideo = controller.butcherResources.find(br=>br.type == 'butcher-videos')
%>








        <div class="container px-0 cz-gallery">



          <div class="mb-3 pb-2 ">


            <div class="row no-gutters">

              <div class="col-lg-6 ">
                <% if (firstImage) { %>
                <div class="mb-3">
                  <%- include('./_partial/product-resource-view.ejs', {first: true, note: false, resource: firstImage}) %>
                </div>
                <% } %>

                <div class="table-responsive " data-simplebar>
                  <div class="d-flex">

                    <% for(var c=0; c< alternativeimages.length; c++) {%>
                    <div class="mr-2">

                      <div class="item-slider item-slider-sm">

                        <div class="card product-card  ">
                          <%- include('./_partial/product-resource-view.ejs', {first: false, note: false, resource: alternativeimages[c]}) %>
                        </div>

                      </div>
                    </div>
                    <%}%>


                  </div>
                </div>


              </div>

              <div id="productapp" v-cloak class="col-lg-6 px-3 ">
                <% if (view.butcher) {%>
                    <%- include('./_partial/butcher-alternatives.ejs', { alternates:  view.alternateButchers }) %>
                    <%}%>
                <% if (view.butcher) { %>
                    <div class="toast-container toast-top-center">
                      <div id="shopcard-added-toast" class="toast mb-3" id="accent-toast" data-delay="50000"
                        role="alert" aria-live="assertive" aria-atomic="true">
                        <div class="toast-header bg-secondary"><i class="czi-cart  mr-2"></i>
                          <h6 class="font-size-sm  mb-0 mr-auto">Sepetiniz güncellendi</h6>
                          <button class="close ml-2 mb-1" type="button" data-dismiss="toast"
                            aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="toast-body">

                          <div v-if="newlyAddedItem" class="mb-2">

                            

                            <div class="text-center">
                              <div class="text-center mb-3">
                                <img class="w-50" width="500" height="500" src="<%= `${__req.helper.imgUrl('product-photos', product.slug)}` %>"
                                  alt="<%=product.name%>">
                              </div>
                              <div>
                                <h3 class="product-title font-size-base mb-2"><a
                                    href="/<%=product.slug%>?butcher=<%=view.butcher.slug%>"><%=product.name%></a>
                                </h3>
                                <div class="font-size-normal"><span
                                    class="font-weight-medium">{{newlyAddedItem.quantity}}</span> <span
                                    class="text-muted">{{newlyAddedItem.purchaseoption.unitTitle }}

                                  </span>

                                  <span>/</span>
                                  <span class="font-size-sm">
                                    {{ formatCurrency(newlyAddedItem.price).val}}.<small>{{formatCurrency(newlyAddedItem.price).krs}}</small>
                                    TL


                                     
                                  </span>

                                  <!-- <span v-if="newlyAddedItem.purchaseoption.unitWeight"
                                    class="d-block text-muted font-size-xs">1
                                    {{newlyAddedItem.purchaseoption.unit}}
                                    {{newlyAddedItem.purchaseoption.unitWeight}}</span> -->

                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="">
                            <div class="d-flex d-flex justify-content-center">
                              <a onclick="return goBack()" class="btn btn-sm btn-primary mr-2">Alışverişe Devam</a>

                              <a onclick="return goShopcard()"  class="btn btn-sm btn-dark "><i
                                  class="czi-cart mr-1"></i>Sepete Git</a>
                              
                            </div>
                          </div>
                          <div>

                          </div>

                        </div>
                      </div>
                    </div>
                    <%} %>


                    <form id="product-form" @submit.prevent="addToShopcard">

                      <% if (controller.reviews.length) { %>
                        <div class="mb-3 text-center">
                          <div class="mb-1">
                            <%- include('./_partial/star-rating.ejs', {val: product.ratingValue }) %>
                          </div>
                          <a href="javascript:gotoComments()"
                            class="font-size-sm text-dark font-weight-medium"><span>Yorumlar
                              (</span><span class="text-primary"><%=controller.reviews.length %></span><span>)</span></a>
  
                        </div>
                        <% } %>





                     
                        
                    

                     

                      

                        <div class="accordion pb-3" id="nutrition-info-panel" role="tablist">
                          <% if (product.featuresText) { %>
                            <% var notes = product.featuresText.split('\n') %>

                            <div class="card rounded-0">
                          <div class="card-header" role="tab">
                            <h3 class=" accordion-heading"><a href="#basic-info"  data-toggle="collapse"><i class="czi-announcement text-muted font-size-lg align-middle mt-n1 mr-2"></i><%=view.name%> <span class="align-middle mt-n1 badge badge-info"></span> <span class="accordion-indicator"></span></a></h3>
            
                               
                          </div>
                          <div class="show bg-secondary border-top" id="basic-info" data-parent="#nutrition-info-panel" role="tabpanel">
                        
                           
                             
                            
                                <ul class="list-unstyled mb-3 px-3 pt-3 font-weight-light">
                                  <%notes.forEach((note, i) => { %>
                                  <li><i class="czi-check-circle text-success align-middle mt-n1 mr-2"></i><%=note%></li>
                                  <%})%>
                                </ul>
        
                             
                       

                            
                          
                          </div>
                        </div>
                          <% } %>
                       
                      <% var resTypes = [];
                      tarifsAndFoods.length && resTypes.push({
                        arr: tarifsAndFoods,
                        title: 'Yemek Tarifleri'
                      })

                      bilgiResources.length && resTypes.push({
                           arr: bilgiResources,
                           title: 'Faydalı Kaynaklar'
                         })
                      
                      %>
                      
                      <% resTypes.forEach(r=> { %>
                        <div class="card rounded-0">
                          <div class="card-header" role="tab">
                            <h3 class="accordion-heading"><a href="#<%=__helper.slugify(r.title)%>" class="collapsed" aria-expanded="false" data-toggle="collapse"><i class="czi-video text-muted font-size-lg align-middle mt-n1 mr-2"></i><%=r.title%> <span class="align-middle mt-n1 badge badge-secondary"><%=r.arr.length%></span>  <span class="accordion-indicator"></span></a></h3>
                          </div>
                          <div class="collapse bg-secondary border-top" id="<%=__helper.slugify(r.title)%>" data-parent="#nutrition-info-panel" role="tabpanel">
                            
                             
                        <ul class="list-unstyled pt-3 px-3">
                       
                        <% r.arr.forEach(t=> { %>
                        <li>
                          <a class="d-block text-dark font-weight-light" href="javascript:openSlider(<%=t.id%>)"><i class="text-primary <%= t.contentType == 'video-youtube' ? 'czi-youtube': 'czi-camera' %> align-middle mt-n1 mr-2"></i><%=t.title%></a>
                        </li>
                        <%})%>
                      </ul>
                      
                   

                        
                          </div>
                        </div>
                      <% }) %>

                     

                     



                        <% if (view.nutritionView.values.length) { %>

                        <div v-if="product && product.nutritionView && selectedNutrition" class="card rounded-0">
  
                          <div class="card-header" role="tab">
                            <h3 class="accordion-heading "><a href="#nutrition-info" class="collapsed" data-toggle="collapse"><i class="czi-ruler font-size-lg align-middle mt-n1 mr-2"></i>Besin Değerleri 
                              <span class="align-middle mt-n1 badge badge-secondary">{{selectedNutrition.calories}}kal</span> 
                              <span  v-if="false" class="align-middle mt-n1 badge badge-success">{{ getNutrition('protein') ? (getNutrition('protein').amount + getNutrition('protein').unit) + '': selectedNutrition.calories + 'kal'}}</span> 
                              <span v-if="false" title="Protein" v-if="getNutrition('protein')" class="align-middle mt-n1 badge badge-success">{{ getNutrition('protein').amount}}</span>
                              <span v-if="false" title="Karbonhidrat" v-if="getNutrition('carb')" class="align-middle mt-n1 badge badge-info">{{ getNutrition('carb').amount}}</span>
                              <span v-if="false" title="Yağ" v-if="getNutrition('fat')" class="align-middle mt-n1 badge badge-warning">{{ getNutrition('fat').amount}}</span>
                              <span
                                  class="accordion-indicator"></span></a></h3>
                                  <% if (false){ %> 
                                  <div class="progress rounded-0   mb-2">
                                    <div class="progress-bar progress-bar-striped bg-dark" role="progressbar" v-bind:style="{width: getDailyPerc('calories') + '%'}" v-bind:aria-valuenow="getDailyPerc('calories')" aria-valuemin="0" aria-valuemax="100">{{selectedNutrition.calories}} kalori</div>
                                  </div>

                                  <div class="progress rounded-0">
                                    <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" v-bind:style="{width: getNutritionPerc('fat') + '%'}" v-bind:aria-valuenow="getNutritionPerc('fat')" aria-valuemin="0" aria-valuemax="100">{{getNutrition('fat') ? getNutrition('fat').amount + getNutrition('fat').unit: '' }}</div>
                                    <div class="progress-bar progress-bar-striped bg-info" role="progressbar" v-bind:style="{width: getNutritionPerc('carb') + '%'}" v-bind:aria-valuenow="getNutritionPerc('carb')" aria-valuemin="0" aria-valuemax="100">{{getNutrition('carb') ? getNutrition('carb').amount + getNutrition('carb').unit: '' }}</div>
                                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" v-bind:style="{width: getNutritionPerc('protein') + '%'}" v-bind:aria-valuenow="getNutritionPerc('protein')" aria-valuemin="0" aria-valuemax="100">{{getNutrition('protein') ? getNutrition('protein').amount + getNutrition('protein').unit: '' }}</div>
                                  </div>
                                  <%}%>
                               
                          </div>
                          <div class="collapse bg-secondary bg-size-cover bg-position-center" style="background-image: url(<%=__config.staticDomain %>/resource/img/ka-cover.png)" id="nutrition-info" data-parent="#nutrition-info-panel" role="tabpanel">
                            <div class="progress rounded-0">
                              <div class="progress-bar progress-bar-striped bg-success" role="progressbar" v-bind:style="{width: getNutritionPerc('protein') + '%'}" v-bind:aria-valuenow="getNutritionPerc('protein')" aria-valuemin="0" aria-valuemax="100">{{getNutrition('protein') ? getNutrition('protein').amount + getNutrition('protein').unit: '' }}</div>
                              <div class="progress-bar progress-bar-striped bg-info" role="progressbar" v-bind:style="{width: getNutritionPerc('carb') + '%'}" v-bind:aria-valuenow="getNutritionPerc('carb')" aria-valuemin="0" aria-valuemax="100">{{getNutrition('carb') ? getNutrition('carb').amount + getNutrition('carb').unit: '' }}</div>
                              <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" v-bind:style="{width: getNutritionPerc('fat') + '%'}" v-bind:aria-valuenow="getNutritionPerc('fat')" aria-valuemin="0" aria-valuemax="100">{{getNutrition('fat') ? getNutrition('fat').amount + getNutrition('fat').unit: '' }}</div>
                            
                            </div>
                            <div class="font-size-sm ">
                             

                              <div class="d-flex align-items-center px-3 pt-3 pb-1 mb-1">
                               
                                <div>
                                  <select v-model="selectedNutrition" class="form-control custom-select">
                                    <option v-for="(option, index) in product.nutritionView.values" v-bind:value="option">{{option.name}}</option>
                                  </select>
                                  <div class="font-size-xs text-muted mt-1" v-if="selectedNutrition && selectedNutrition.source" >
                                    <span>Kaynak: </span><a class="text-dark" target="_blank" :href="selectedNutrition.sourceUrl">{{selectedNutrition.source}}</a>
                                  </div>
                                  <span class="text-dark font-size-xs" v-if="selectedNutrition.description"><i class="cz-icon  czi-announcement"></i> {{selectedNutrition.description}}</span>
                                  
                                </div>
                                <div>
                                  <span class="ml-2 font-size-md">
                                   
                                  </span>
                                </div>
                              </div>
                             
                             
    
                           
    
                                <div>
                                  <div class="d-flex flex-nowrap justify-content-between align-items-center border-bottom font-size-md py-2 px-3">
                                  <div>
                                    <span class="font-weight-bold">Kalori</span> {{ selectedNutrition.calories }}
                                  </div>
                                    <span class="font-size-xs">Günlük%</span>
                                  </div>
                                  <div v-for="(val, index) in getNutritionValues(selectedNutrition)" class="d-flex flex-nowrap justify-content-between align-items-center py-1 px-3 border-bottom">
                                    <div>
                                      <span v-bind:class=" {'text-warning': val.type == 'fat', 'text-info': val.type == 'carb', 'text-success': val.type == 'protein' , 'font-weight-bold': val.type.indexOf(':') == -1, 'ml-3': val.type.indexOf(':') > 0   } ">{{val.title}}</span> 
                                      <span v-bind:class=" {'font-size-sm badge badge-warning': val.type == 'fat', 'font-size-sm  badge badge-info': val.type == 'carb', 'font-size-sm  badge badge-success': val.type == 'protein' } ">
                                        {{ val.amount }} {{ val.unit }}


                                      </span> 
                                      

                                    </div>
                                    <span v-if="getDailyPerc(val.type) > 0.5" v-bind:class="{'font-weight-bold': getDailyPerc(val.type) >= 25 && val.type != 'cholesterol'}" >{{getDailyPerc(val.type) + '%'}}</span>
                                
                                  </div>
                                  <div v-if="getNutritionVitamins(selectedNutrition).length > 0" class="row font-size-sm pt-2 no-gutters">
                                    <div v-for="(val, index) in getNutritionVitamins(selectedNutrition)" class="col-6">
                                      <div class="d-flex flex-nowrap justify-content-between align-items-center px-3 px-3 pb-2">
                                        <span >{{val.title}}</span> 
                                        <span v-bind:class="{'font-weight-bold':val.amount >= 25}">
                                          {{ getDailyPerc(val.type) }}{{ '%' }}

                                        </span>

                                      </div>
                                  
                                    </div>
                                  </div>
                                

                                  
                                </div>

                            </div>
                            <div class="font-size-xs p-3">
                                <span>
                                  Günlük değerler ortalama 2000 kalori üzerinden yetişkinler için hesaplanmıştır.
                                </span>
                            </div>
                          </div>
                        </div>

                        <% } %>

                        </div>
                        <%if (controller.shopcard.items.length == 0) { %>
                        <div class="px-3 pt-3 mb-3 bg-size-cover bg-position-center border"
                        style="background-image: url(<%=__config.staticDomain %>/resource/img/banner-bg.jpg)">
                        <h5 class="h5 text-danger">2021'e Merhaba Kampanyası</h5>
                        <p><strong>250TL ve üzeri</strong> alışveriş yapın, <strong class="text-dark">
                          <%- include('./_partial/currency.ejs', {value: 10}) %>
                    
                        </strong> değerinde ek puan kazanın.
                        </p>
                        </div>

                        <% } %>

                       
                      <% if (!view.butcher) { %>
                        <% if (!__req.prefAddr) { %>
                       
  
                        <div class="bg-secondary border font-size-sm mb-2 p-3">
  
  
  
  
                          <div class="mb-3 d-block font-size-sm  text-center">
                            <% if (controller.startPrice && controller.startPrice.title) { %>
                              <h5 class="h5">
                                <%=controller.startPrice.title%>
                              </h5>
                            <% } %>
                          
  
                            <p class="lead">
                              <% if (controller.startPrice) { %>
                                <% if (controller.startPrice.basedOn == 'global') { %>
                                  
  
                                  <%- include('./_partial/currency.ejs', {value: controller.startPrice.view.price, unit: controller.startPrice.view.unitTitle}) %><br>başlangıç fiyatlarıyla.
                                
                     
                          
  
                                <% } else { %>
                                  <%- include('./_partial/currency.ejs', {value: controller.startPrice.view.price, unit: controller.startPrice.view.unitTitle}) %>'
                             
  
                                  <%}%>
                                <% } else { %>
                                  Önce Semt Seçin
                                <%}%>
  
                                </p>
                            <% if (controller.startPrice) { %>
                              <div class="font-size-md mb-3">
                                <% if (controller.startPrice.basedOn == 'global') { %>
  
                                  <div>
                                    <span>Alışverişe başlamak için semt seçin.
                                  </div>
    
                            
                                <% } else { %>
                                  <div>
                                    <span>İstediğiniz gün ve saatte kapınıza getiriyoruz.</span> 
                                    Alışverişe başlamak için şimdi semtinizi seçin.
                                  </div>
    
                                <% } %>
                              </div>
                            
  
  
                            <% } else { %>
                              <div>
                                <span class="font-weight-medium">Alışverişe başlamak için</span> 
                                şimdi semtinizi seçin.
                              </div>
                              <%}%>
                        
  
                           
  
  
                          </div>
  
                          <div class="text-center">
                            <button @click="selectArea(null)" type="button" class="btn btn-primary"><i
                                class="czi-location font-size-lg mr-2"></i>Semtinizi Seçin</button>
                          </div>
  
  
                        </div>
                        <%} else { %>
                        <div class="bg-secondary border p-3  mb-2">
  
  
  
  
                          <div class="mb-3  text-center">
                            <% if (__req.query.butcher) {  %>
                          
                              <% if (!controller.dispatchingAvailable) { %>
                                <h5 class="h6 ">Henüz Semtinizde Değiliz</h5>
                                <p>
      
                                  Kasap seçim kriterlerimiz oldukça detaylı ve belirli bir planda ilerliyoruz.
                                  Çünkü sizlere en iyiyi sunmak için çalışıyoruz.
      
                                </p>
  
                                <script>
                                  gtags.push(['noservice', '<%=__req.prefAddr.display%>', '<%=product.slug%>']);
                                  gtags.push(['noproduct', '<%=product.slug%>', '<%=__req.prefAddr.display%>']);
                                </script>
      
                                <%} else { %>
                                <h5 class="h5">Semtinize hizmet
                                  veren kasaplarımız mevcut</h5>
                                <p>Ancak bu kasabımız semtinize hizmet veremiyor veya bu ürünü sağlayamıyor.</p>
                                <script>
                                  gtags.push(['noproduct', '<%=product.slug%>', '<%=__req.prefAddr.display%>']);
                                  gtags.push(['noservice', '<%=__req.prefAddr.display%>', '<%=product.slug%>']);
                                </script>
                                <% } %>
  
  
                            <% } else { %>
                              <% if (!controller.dispatchingAvailable) { %>
                                <h5 class="h6">Henüz Semtinizde Değiliz</h5>
                                <p>
      
                                  Kasap seçim kriterlerimiz oldukça detaylı ve belirli bir planda ilerliyoruz.
                                  Çünkü sizlere en iyiyi sunmak için çalışıyoruz.
      
                                </p>
  
                                
                                <script>
                                  gtags.push(['noproduct', '<%=product.slug%>', '<%=__req.prefAddr.display%>']);
                                  gtags.push(['noservice', '<%=__req.prefAddr.display%>', '<%=product.slug%>']);
                                </script>
                               
      
                                <%} else { %>
                                <h5 class="h5">Hizmet Veriyoruz</h5>
                                <p class="text-left">Ancak hiçbir kasabımız
                                  bu ürünü şu anda semtinize sağlayamıyor.</p>
                                  <p class="border bg-white p-3 text-left">
                                    <i class="czi-icon czi-truck mr-1"></i>
                                    <a class="font-weight-bold" href="javascript:gotoUrl('/tum-turkiye')">Tüm Türkiye'ye</a> gönderebildiğimiz ürünlerimiz var, mutlaka göz atın.
                                  </p>
                                  <script>       
                                  gtags.push(['noproduct', '<%=product.slug%>', '<%=__req.prefAddr.display%>']);
                                  gtags.push(['noservice', '<%=__req.prefAddr.display%>', '<%=product.slug%>']);

                                  </script>
                                <% } %>
                            <% } %>
                           
  
  
                          </div>
                          <% if (!controller.dispatchingAvailable) { %>
                          <div class="d-flex justify-content-center">
  
                            <% if (__req.query.frame != '1') { %>
                            <button @click="selectArea(null)" type="button" class="btn mr-2 btn-primary"><i
                                class="czi-location  mr-2"></i>Semt Seç</button>
                            <% } else { %>
                              <button onclick="window.parent.purchase.selectAddress('<%=product.slug%>')" type="button" class="btn mr-2 "><i
                                class="czi-location  mr-2"></i>Semt Seç</button>
                            <% } %>
                            <a class="btn btn-primary " onclick="return showButchers()">Kasaplarımız<i
                                class="czi-arrow-right mr-2"></i></a>
                          </div>
                          <%} else {%>
         
  
                          <div class="d-flex justify-content-center">
                            <a class="btn  btn-primary mr-2 btn-sm" onclick="return goBack()" >Alışverişe Devam</a>
  
                            <% if (__req.query.frame != '1') { %>
                              <button @click="selectArea(null)" type="button" class="btn btn-sm mr-2 btn-primary "><i
                                  class="czi-location mr-2 "></i>Semt Seç</button>
                              <% } else { %>
                                <button onclick="window.parent.purchase.selectAddress('<%=product.slug%>')" type="button" class="btn btn-sm mr-2 btn-primary "><i
                                  class="czi-location mr-2 "></i>Semt Seç</button>
                              <% } %>
  
                          </div>
  
                         
                          <%}%>
                    
                                  </div>
                                <%}%>
  
                          <% } %>

               


                      <a id="aftersetloc"></a>








                        <a id="noteanchor"></a>

                       


                        <input type="hidden" id="product-id" value="<%= product.id %>" />

                      
                        <div>

                       
                          <%if (view.butcher) {  %>

  <%if (controller.shopcard.items.length == 0 && otherButcherAlternatives && (controller.showOtherButchers())) {%>
                             
                          <div class="d-flex  font-size-sm align-items-center justify-content-between ">
                            <span>
                             
                            </span>


                           
                            <a class="text-dark mb-2 font-weight-medium" href="javascript:App.scrollToAnchor('#other-butchers-panel')"><span>Diğer Kasaplar (</span><span class="text-primary"><%=otherButcherAlternatives %></span><span>)</span></a>
          
                          </div>
<% } %>



                            <div class="mb-3">

                              
                         
                            <%- include('./_partial/butcher-product-panel.ejs', { butcherVideo: butcherVideo }) %>

                         
                        </div>
                          <%}%>
                  
                      
                  
                  
                  
                  
                  
                                  
                   
                  
                             
                  
                               

                        <div class="mb-3">
                          <%- include(`./_partial/product.${product.productType}-editor.ejs`, {man: controller.ProductTypeManager}) %>

                        </div>
                    
                          
                         
                            
                        <%if (view.butcher) {  %>                       
                         
                          <div class="d-flex mb-1 font-size-sm align-items-center justify-content-between ">
                            <span class="text-dark font-weight-medium">
                             
                            </span>
                           
                               <a v-if="selectedUnit && selectedUnit.perPerson" @click="showCalculator(selectedUnit)"
                              class="text-dark font-weight-medium"><i class="czi-calculator mr-1"></i>Miktar Hesaplayıcı</a> 
                                           
                          </div>

                    
                          <div class="bg-white mb-2 pb-3 border shadow-lg">
                            <div v-if="product && product.purchaseOptions.length > 1">
                              <ul class="nav nav-pills nav-pills-dark nav-fill mb-2">
                                <li v-for="(option, index) in product.purchaseOptions" class="nav-item h-100">
                                  <a class="nav-link h-100 shadow-none " v-bind:class="{ active: option == selectedUnit }"
                                    @click="selectedUnit = option">{{option.unitTitle}}
                                   
                                    <span v-if="option.unitPrice > 0.00" class="d-block font-size-sm">
                                      {{  formatCurrency(option.unitPrice).val}}.<small>{{formatCurrency(option.unitPrice).krs}}</small>
                                      TL
                                    </span>
                                    
                                          </a>
                                            
                                        </li>
                      
                                      </ul>
                      
                                    
                      
                      
                                  </div>
                      
                                  
                                  
                                  <div v-if="selectedUnit" class="px-3">
                                  
                                      <div class="md-content mb-3 mt-3 border-bottom" v-html="selectedUnit.desc" v-if="selectedUnit.desc">
                                         
                                      </div>
                           
                                      <% if (view.butcher && __req.prefAddr) { %>
                                      <div class="d-flex  flex-nowrap justify-content-end align-items-center">
                                        <h5 class="h6 d-none mb-2 text-accent "><i class="czi-thumb-up mr-2"></i>Şimdi satın alın</h5>
                      
                                        <%if (__req.query.frame != '1') { %> 
                                        <button title="<%= __req.prefAddr ? __req.prefAddr.level3Text: 'Semtinizi Seçin' %>"
                                    @click="selectArea(null, '')" type="button" class="rounded-0 d-none btn
                                    btn-secondary btn-sm"><i class="czi-location font-size-lg "></i>
                                          <% } else {  %>
                                            <button title="<%= __req.prefAddr ? __req.prefAddr.level3Text: 'Semtinizi Seçin' %>"
                                              onclick="window.parent.purchase.selectAddress('<%=product.slug%>')" type="button" class="rounded-0 d-none btn
                                              btn-secondary btn-sm"><i class="czi-location font-size-lg "></i>
                                            
                                  <% }%>
    
    
                                    </button>
    
    
    
                            </div>
                                  </div>
                            <% } %>
                        
                      
                        
                      
                           
                            <div class="mt-3 d-flex align-items-center justify-content-center">
                              <p class="font-size-lg" v-if="selectedUnit.unit != 'kg'">Kaç <b>{{ selectedUnit.unitTitle }}</b> hazırlayalım?</p>
                              <p class="font-size-md" v-if="selectedUnit.unit == 'kg'"><b>Ne kadar</b> hazırlayalım?</p>
                           
                              
                      
                            </div>

                          <amount-input class="mb-2 font-size-md" :def="quantity || selectedUnit.default" :min="selectedUnit.min"
                          :max="selectedUnit.max" :step="selectedUnit.step" v-model="quantity"
                          :unit="selectedUnit.unitTitle" >
                      
                        </amount-input>
                        <div class="text-center mb-3" v-if="selectedUnit && selectedUnit.unitWeight">
                          <span class="d-block text-muted font-size-sm">{{selectedUnit.unit != 'kg' ? '1 ' + selectedUnit.unit:''}} {{selectedUnit.unitWeight}}</span>
                    
                         </div>

                     


                        

                            <div v-if="selectedUnit" class="px-3 my-3 d-flex justify-content-between">
                              <div class="text-center">
                                <span class="text-muted font-size-sm d-block">
                                  
                                   Puan
                                </span>
                      
                                <money-view class="badge badge-success font-size-md font-weight-medium" :money="puan">
                                </money-view>
                              </div>
                      
                              <div class="text-center">
                                <span class="text-muted font-size-sm d-block">
                                  Tutar
                                </span>
                      
                                <money-view class="badge badge-dark font-weight-medium font-size-md" :money="price">
                                </money-view>
                              </div>
                      
                      
                            </div>

                        

                            <% if (view.butcher && __req.prefAddr) { %>


                              <div class="form-group px-3">
                                
    
                              </label>
                              <textarea v-model="note" maxlength="250"
                                :placeholder="(selectedUnit && selectedUnit.notePlaceholder) || (product && product.notePlaceholder) || 'İletmek istediğiniz notunuz varsa burayı kullanabilirsiniz.'"
                                class="form-control font-size-sm" rows="4" name="note" id="note">
    
                                                                      <%=view.note%>
                                                                  </textarea>
                            </div>
    
                          
                            <div class="px-3">
                              <button data-tag="true" data-category="shopcard/add" data-action="<%=view.butcher.slug%>"
                                data-label="<%=product.slug%>" id="addtoscbtn" class="btn btn-primary btn-block"
                                type="submit"><i
                                  class="czi-cart font-size-lg mr-2"></i><%= controller.shopCardIndex >= 0 ? 'Sepeti Güncelle': 'Sepete Ekle' %></button>
                            </div>
                         
    
                            <% } %>

                          </div>
                      
                        
                          <% } %>

                           



                         

                    
                      
                        <% if ( view.alternateButchers.length && controller.showOtherButchers()) { %>
                          <div id="other-butchers-panel" class="border bg-secondary">
                            <% let alt2Show = 2 %>
                      
                           
                            
                              <p class="mb-0 pb-2 border-bottom pl-2 pt-2 font-size-md">Diğer Kasaplar 
                      

                      
                                <% if (view.alternateButchers.length > alt2Show) { %>
                                 - 
                                    <a class="text-dark font-weight-medium" href="javascript:showOtherButchers()"><span>Tümü (</span><span class="text-primary"><%=otherButcherAlternatives %></span><span>)</span></a>
                      
                                 
                                <% } %>
                      
                                </p>

                                <ul v-if="product  && (product.alternateButchers.length > 1)" class="nav nav-pills nav-pills-dark nav-fill mb-2">
                                  <li class="nav-item mr-0">
                                    <a class="nav-link shadow-none font-size-xs" @click="alternateSort = null" v-bind:class="{ active: alternateSort == null }">Oto Sıra</a>

                                  </li>

                                  <li class="nav-item mr-0">
                                    <a class="nav-link shadow-none font-size-xs" @click="alternateSort = toggleSort(alternateSort, 'butcher.kgPrice', 'asc')" v-bind:class="{ active: isSorted(alternateSort, 'butcher.kgPrice') }">Fiyat</a>

                                  </li>
                                  <li class="nav-item mr-0">
                                    <a class="nav-link  shadow-none font-size-xs" @click="alternateSort = toggleSort(alternateSort, 'butcher.userRatingAsPerc', 'desc') " v-bind:class="{ active: isSorted(alternateSort, 'butcher.userRatingAsPerc') }">Memnuniyet</a>

                                  </li>
                                  <li class="nav-item mr-0">
                                    <a class="nav-link  shadow-none font-size-xs" @click="alternateSort = toggleSort(alternateSort, 'dispatcher.distance', 'asc')" v-bind:class="{ active: isSorted(alternateSort, 'dispatcher.distance')  }">Yakınlık</a>

                                  </li>
                                </ul>

                           
                          
                           
                             
                      
                                <div v-if="product">


                                  <div v-for="(alt, index) in sortedAlternates.slice(0, <%=alt2Show%>)">
                                    <a class="media px-2 align-items-start flex-grow-1" :data-butcher="alt.butcher.slug" href="#newbutcher" @click="selectNewButcher(alt.butcher)">
                                   
                                       <img class="w-25 align-self-start"
                                          :src="alt.butcher.thumbnail" :alt="alt.butcher.name">
                      
                                    
                      
                                      
                                      <div class="media-body align-self-start px-2">


                                        <div class="d-flex align-items-center justify-content-between">
                                          <h6 class="h6 mb-0 mr-2">{{alt.butcher.name}}</h6>
                                         
                                            <span v-if="alt.butcher.puanData" class="badge badge-success font-weight-medium">
                                              %{{alt.butcher.puanData.rate * 100 }}  Puan
                                            </span>
                                          
                                        </div>

                                        

                                        <div class="text-muted font-size-xs mb-2" >
                                          <span v-if="alt.butcher.locationText" class="d-block">
                                            {{alt.butcher.locationText}}{{alt.dispatcher.distance && (alt.dispatcher.distance < 50) ? ', ' + alt.dispatcher.distance.toFixed(0) + 'km':''}}

                                          </span>
                                          
                                         <span v-if="alt.dispatcher.priceInfo" >{{alt.dispatcher.priceInfo}}</span>  
                                        </div>
                                        
                                        
                                          <money-view v-if="!alt.butcher.kgPrice && selectedUnitForAlternate(alt.butcher)" :unit="selectedUnitForAlternate(alt.butcher).unitTitle" 
                                          
                                          class="font-size-md text-dark" :money="selectedUnitForAlternate(alt.butcher).unitPrice"></money-view>
                                          <money-view v-else unit="Kg" 
                                          
                                          class="font-size-md text-dark" :money="alt.butcher.kgPrice"></money-view>
                            
                                       
                                         
                                         
                                          
                                       
                                            <div class="font-size-sm font-italic text-dark" v-if="alt.butcher.productNote" v-html="alt.butcher.productNote">                            
                       
                                            </div>   

                               
                                         
                                       
                                
                      
                      
                                      </div>
                                    </a>
                                  
                                    <div class="bg-white border-bottom p-2 mb-2">
                                      <div v-if="alt.butcher.shipSuccessText" class="text-center text-dark font-size-xs">
                                        {{alt.butcher.shipSuccessText}} sipariş
                                      </div>
                                      <div class="d-flex w-100">
                                        <div class="w-50 pr-2" v-if="alt.butcher.userRatingAsPerc > 0">
                                          <div class="font-size-xs text-muted ">Memnuniyet</div>
                                          <div class="progress rounded-0">
                                            <div class="progress-bar font-weight-medium bg-warning" role="progressbar" :style="'width:' + alt.butcher.userRatingAsPerc + '%'" :aria-valuenow="alt.butcher.userRatingAsPerc" aria-valuemin="0" aria-valuemax="100">
                                              {{alt.butcher.userRatingAsPerc}}%
                                            </div>  
                                          </div>
                                        </div>
                                        <div class="w-50 " v-if="alt.butcher.shipRatingAsPerc > 0">
                                          <div class="font-size-xs text-muted ">Teslimat Başarısı</div>
                                          <div class="progress rounded-0">
                                            <div class="progress-bar font-weight-medium bg-warning" role="progressbar" :style="'width:' + alt.butcher.shipRatingAsPerc + '%'" :aria-valuenow="alt.butcher.shipRatingAsPerc" aria-valuemin="0" aria-valuemax="100">
                                              {{alt.butcher.shipRatingAsPerc}}%
                                            </div>  
                                          </div>
                                        </div>
                                       
                                  
                                       
              
                                       
                                      </div>
                                    </div>      
                                  </div> 

                           
                                </div>
                      
                      
                      
                           
                          
                        </div>
                         <% } %>

                      


                        



                        </div>
                  
                                  </form>
                         
                  
                  
                       



                  </div> <!-- product app -->


                </div>

                <div id="tabpc"></div>


                <div>

                  <ul class="nav nav-tabs" id="optionsTab" role="tablist">

                    <li class="nav-item">
                      <a class="nav-link active %>" id="home-tab" data-toggle="tab" href="#home" role="tab"
                        aria-controls="home" aria-selected="true">Bilgi</a>
                    </li>
           
                    <%if (controller.reviews.length) { %>

                 
                       
                        <li id="usercomments" class="nav-item">
                          <a class="nav-link " id="comments-tab" data-toggle="tab" href="#comments" role="tab"
                            aria-controls="comments">Yorumlar</a>
                        </li>
                        <% } %>

                   


                        </ul>

                        <div class="tab-content px-4" id="myTabContent">
                          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

                            <%if (product.mddesc) { %>

                            <%- controller.markdown.render(product.mddesc || '') %>

                            <%}%>
            
                   
                     
                 
            
                  <% if (videoTarifs.length) {%>
                            <div id="tarifVideos"
                              class="d-flex flex-wrap justify-content-between align-items-center pt-1 border-bottom pb-1 mb-2">
                              <h3 class="h5 mb-0 mr-2">Et Yemek Tarifleri</h3>
                            </div>

                            <p>
                            <span class="btn btn-sm btn-primary mr-2"><i class=" czi-thumb-up mr-2">

                              </i>Eti Bizden</span>seçeneği ile etinizi istediğiniz yemeğe uygun olarak
                            hazırlıyoruz.</p>




                            <div class="row mb-3 ">
                              <% tarifsAndFoods.forEach((resource,i) => {%>
                              <% if (resource.contentType == "video-youtube") { %>
                              <div class="col-md-4 col-sm-6">
                                <%- include('./_partial/product-resource-view.ejs', {first: false, note: true, resource: resource}) %>




                              </div>
                              <% } %>
                              <%})%>



                            </div>
                            <%}%>
            
                    <% if (nonDisplayedResources.length) { %>
                            <% nonDisplayedResources.forEach((resource,i) => {%>
                            <div class="d-none">
                              <%- include('./_partial/product-resource-view.ejs', {first: false, note: false, resource: resource}) %>


                            </div>
                            <%})%>

                            <%}%>
            
                    <% if (otherVideos.length) {%>

                            <h3 class="border-bottom h5">Diğer kaynaklar</h3>








                            <div class="row mb-3">
                              <% otherVideos.forEach((resource,i) => {%>

                              <div class="col-md-4 col">


                                <%- include('./_partial/product-resource-view.ejs', {first: false, note: false, resource: resource}) %>


                              </div>
                              <%})%>
                            </div>
                            <%}%>
            
                            <h3 class="border-bottom h5">Online Sipariş</h3>

                            <p>
                              Yerel usta kasaplarımızdan <strong><%=product.name%> online siparişi
                              </strong> verebilir ve kasaplarımızın <strong>eve servis</strong> veya
                              <strong>paket servis</strong> olarak adlandırabileceğimiz hizmetlerinden
                              faydalanabilirsiniz:

                            </p>

                            <ul>
                              <li>
                                Semt seçimi yapın ve kasaptanAl.com anlaşmalı kasaplarımızı
                                görüntüleyin.
                              </li>
                              <li>
                                <strong>Online et siparişi</strong> vermek istediğiniz kasabımızı seçin
                                ve ürününüzü sepetine ekleyin.
                              </li>
                              <li>
                                Adresinizi girin ve siparişinizi tamamlayın.
                              </li>
                            </ul>
                            <p>
                              Tüm kasap iş ortaklarımız <strong>online ödeme</strong> kabul etmektedir.
                              Sepetinizdeki et ve et ürünlerini online ödeyerek zamandan kazanın.
                            </p>
                            <% if (tarifsAndFoods.length) { %>
                            <h3 class="border-bottom h5">Et Yemekleri</h3>
                            <p>
                              <strong>
                                <%=product.name%>
                              </strong>
                               ile aşağıdaki <strong>et yemekleri</strong> yapılabilir.
                            </p>
                            <ul>
                            <% tarifsAndFoods.forEach(tf=> { %>
                              <li><a title="<%=tf.title%>" href="/et-yemekleri/<%=tf.slug%>"><%=tf.title%></a></li>
                            <%})%>
                          </ul>

                            <% } %>


                     
                            <h3 class="border-bottom h5"><%=product.name%> Fiyatı</h3>





                            <p>



                              <strong><%=product.name%> fiyatları</strong> semtinize ve kasaplarımıza
                              göre farklılık göstermektedir. <strong>En uygun <%=product.name%>
                                fiyat</strong> bilgisi semt ve ürünü online olarak sağlayabilecek kasap
                              seçiminiz ardından otomatik olarak hesaplanmaktadır.
                            </p>

                            <% var categories = product.getCategories() %>

                            <% var priceCategories = [];
                           categories.forEach(c=>{
                             var pc = controller.req.__pricecategories.find(p=> (p.categoryid == c.id));
                             pc && priceCategories.push(pc)
                           })
                            
                           
                           %>
                            <% if (priceCategories.length) { %>
                            <p>
                              Aşağıdaki kategorilerdeki ürünlerimiz için <strong>et fiyatlarını</strong>
                              da incelemek isteyebilirsiniz.
                            <ul>


                              <% priceCategories.forEach(pc=> { %>
                              <li>
                                <a href="/<%=pc.slug %>"><%=pc.name %></a>
                              </li>

                              <% }) %>
                            </ul>
                            </p>
                            <%  } %>
                            <p>
                              Ayrıca <a href="/kasaplar">kasaplar</a>ımızın <a href="/et-fiyatlari">tüm
                                et fiyatlarını</a> da görüntülemek isteyebilirsiniz.
                            </p>


                            <% if (view.nutritionView && view.nutritionView.values.length > 0) { %>
                              <h3 class="border-bottom h5"><%=product.name%> Kalori &amp; Besin Değerleri</h3>
                              <p>
                                <strong>
                                <%=view.nutritionView.values[0].name %> <%=product.name%></strong> ortalama <strong><%=view.nutritionView.values[0].calories %> kalori</strong> içermektedir. 
                                  Bu değerle günlük kalori ihtiyacınızın %<%= Math.round((view.nutritionView.values[0].calories / view.nutritionView.dailyValues['calories']) * 100) %> oranına karşılık bölümünü elde edebilirsiniz.
                              </p>

                              <%
                                var protein = view.nutritionView.values[0].values.find(p=>p.type=='protein');
                                var fat = view.nutritionView.values[0].values.find(p=>p.type=='fat');
                              %>
                              <% if (protein) { %>
                              <p>
                                Kaliteli protein olarak <strong><%=view.nutritionView.values[0].name %> <%=product.name%></strong> ortalama <strong><%= protein.amount %> <%= protein.unit %> </strong> protein içermektedir.
                              </p>
                              <% } %>
                              <% if (fat) { %>
                              <p>
                                Yağ değerlerine baktığımızda <strong><%=view.nutritionView.values[0].name %> <%=product.name%></strong> ortalama <strong><%= fat.amount %> <%= fat.unit %> </strong> yağ içermektedir.
                              </p>
                              <% } %>
                              <% if (view.nutritionView.values.length > 1) { %>
                                <% var otherUnits = view.nutritionView.values.map(p=>p.name).join(', ') %>
                              <p>
                                KasaptanAl.com farklı tüketim değerleri <strong><%=otherUnits%></strong> değerleri için <strong><%=product.name%> besin ve kalori değerlerini</strong> içermektedir.
                              
                                
                                
                              </p>
                              <%}%>

                              <% var vitamins = view.nutritionView.values[0].values.filter(p=>p.type.startsWith('vitamin')); %>

                              <% if (vitamins.length) { %>
                                <h4 class="border-bottom h6"><%=product.name%> Vitamin Değerleri</h3>
                                <p>
                                  <strong><%=view.nutritionView.values[0].name %> <%=product.name%></strong> içerdiği vitaminler ve günlük ihtiyacı karşılama oranları şu şekildedir.
                                </p>
                                <ul>
                                  <% vitamins.forEach(v=>  {  %>
                                    <li>
                                    <%=v.title%>, <%=v.amount%><%=v.unit%> 
                                  </li>
                                  <%})%>
                                </ul>
                              <% } %>
                              <% if (view.nutritionView.values[0].source) %>
                              <p>
                                Not: Besin değerlerinin elde edilmesinde kaynaklardan birisi olarak <a target="_blank" href="<%=view.nutritionView.values[0].sourceUrl%>"><%=view.nutritionView.values[0].source%></a> kullanılmıştır.
                              </p>
                            <% } %>

                          </div>

                          <%if (controller.reviews.length) { %>
                          <div class="tab-pane fade <%=controller.reviews.length?'': '' %> " id="comments" role="tabpanel" aria-labelledby="comments-tab">

                            <% controller.reviews.forEach(r => {  %>
                            <div class="product-review pb-4 mb-4 border-bottom">
                              <div class="d-flex mb-3">
                                <div class="media media-ie-fix align-items-center mr-4 pr-2">
                                  <div class="avatar">

                                    <img width="140" height="140" src="<%=__config.staticDomain %>/resource/img/avatar.jpg"
                                      alt="<%=r.displayUser%>">

                                  </div>

                                  <%
                      
                        const dateops = { year: 'numeric', month: 'long'};
            
                      %>

                                  <div class="media-body pl-3">
                                    <h6 class="font-size-sm mb-0"><%=r.displayUser%></h6>
                                   
                                      <a href="/<%=r.areaSlug%>-kasap" class="font-size-ms"><%=r.level3Text%></a>

                                   
                                  </div>
                                </div>
                                <div>
                                  <%- include('./_partial/star-rating.ejs', {val: r.userRating1 }) %>

                                  <div class="font-size-ms text-muted">
                                    <%=r.itemDate.toLocaleDateString('tr-TR', dateops)%> tarihli
                                    
              
                                    <a href="/<%=r.ref2slug%>"><%=r.ref2Text%></a>

                                  
                                    siparişi
                                  </div>
                                </div>
                              </div>
                              <p class="font-size-md mb-2">
                                <em>
                                  <%= r.content %>

                                </em>
                              </p>
                              <% if (r.settings && r.settings.products) { %>
                              <span class="d-block mb-1 font-weight-medium font-size-xs">
                                Sipariş verilen ürünler:
                              </span>


                              <% r.settings.products.forEach(p => { %>

                              <a class="mr-2 font-size-xs " href="/<%=p.slug%>"><i
                                  class="mr-1 czi-check-circle"></i><%=p.name%></a>




                              <% })%>


                              <% } %>
                              <% if (r.replyContent) { %>
                                <div class="font-size-sm text-dark mt-2 bg-secondary p-3 mt-3">
                                  <% if (r.replyDisplayUser) { %>
                                    <span class="d-block font-weight-bold"><%=r.replyDisplayUser%></span> 
                                  <% } %>
                                  
                                  <%- controller.markdown.render(r.replyContent) %>
                                </div>
                    
                              <% } %>
                            </div>
                            <% }) %>

                          </div>

                          <% } %>

                        </div>

                      </div> <!-- product desc & comments -->

                      <%if (__req.query.frame != '1') { %> 
                        <div class="container">
        
                          <%- include('./_partial/category-slider', { header:true, title: 'Ürünlerimiz', allUrl: '/kasap-urunleri' }); %>
                    
                        </div>
                        <%}%>
                  </div>
        </div>
        </div>

             








                 <%if (__req.query.frame != '1') { %> 
                  <% include ./_partial/footer %>
                 <% } %> 
                <% include ./_partial/scripts %>

                <script>
                  <% if (__req.prefAddr) {  %>
                    gtags.push(['productview', '<%=product.slug%>', '<%=__req.prefAddr.display%>']);
                    gtags.push(['locationproduct', '<%=__req.prefAddr.display%>', '<%=product.slug%>']);
                  <% } %>
                  <% if (view.butcher && __req.prefAddr) {  %>
                    gtags.push(['butcherlocation', '<%=view.butcher.slug%>', '<%=__req.prefAddr.display%>']);
                    gtags.push(['butcherproduct', '<%=view.butcher.slug%>', '<%=product.slug%>']);
                    gtags.push(['butcherproductbylocation', '<%=view.butcher.slug%>/<%=product.slug%>', '<%=__req.prefAddr.display%>']);
                    gtags.push(['butcherlocationbyproduct', '<%=view.butcher.slug%>/<%=__req.prefAddr.display%>', '<%=product.slug%>']);


                    if (req.query.butcher) {
                      gtags.push(['butcherautoselected', '<%=view.butcher.slug%>', '<%=product.slug%>']);
                      gtags.push(['butcherautoselectedin', '<%=view.butcher.slug%>', '<%=__req.prefAddr.display%>']);
                      gtags.push(['butcherautoselectedinproduct', '<%=view.butcher.slug%>', '<%=product.slug%>/<%=__req.prefAddr.display%>']);
                      gtags.push(['productautoassigned', '<%=product.slug%>', '<%=view.butcher.slug%>']);
                    } else {
                      gtags.push(['butchermanualselection', '<%=view.butcher.slug%>', '<%=product.slug%>']);
                      gtags.push(['butchermanualselectionin', '<%=view.butcher.slug%>', '<%=__req.prefAddr.display%>']);
                    }


                  <% } %>


          
                </script>

                <script>
                  window.App.ProductApp.shopCardIndex = <%= controller.shopCardIndex %>;
                  var prod = <%- JSON.stringify(view) %>;
                  window.App.ProductApp.product = prod;
                  window.App.WeightCalculatorApp.product = prod;
                  function setBody() {

                    // $("body").animate({ opacity: 1 }, 100, function () {

                    // });
                  }


                  <%if (__req.query.frame == '1') { %>
                  $(document).ready(function() {
                    $('#myTabContent a').attr('target','_blank');
                  })
                  <% } %>

                  function goShopcard() {
                    <%if (__req.query.frame != '1') { %>
                      window.location.href = '/alisveris-sepetim';
                    <%} else { %>
                      window.parent.purchase.goShopcard();
                    <% } %>
                  }

                  function gotoUrl(url) {
                    <%if (__req.query.frame != '1') { %>
                      location.href = url;
                    <%} else { %>
                      window.parent.purchase.go(url);
                    <% } %>
                  }

                  function showButchers() {
                    <%if (__req.query.frame != '1') { %>
                      location.href = '/kasaplar';
                    <%} else { %>
                      window.parent.purchase.go("/kasaplar");
                    <% } %>
                  }

                  function goBack() {
                    <%if (__req.query.frame != '1') { %>
                    
                    var toBack;
                    if (document.referrer.indexOf(location.protocol + "//" + location.host) === 0) {
                      var current = location.protocol + "//" + location.host + location.pathname;                      
                      if (document.referrer.indexOf(current) === 0) {
                        toBack = false;
                      }
                      else if (document.referrer.indexOf('/alisveris-sepetim') >= 0) {
                        toBack = false;
                      } else toBack = true;
                    } else toBack = false;
                    if (toBack) {
                      window.history.go(-1);
                      return false;
                    }
                    else window.location.href = "/kasap-urunleri"
                    <% } else { %>
                    window.parent.purchase.closePurchaseDialog()
                    <% } %>
                  }

                  function gotoComments() {
                    window.App.activaTab('comments');
                    window.App.scrollToAnchor('#usercomments')
                  }

                  function showOtherButchers() {
                    $('#butcher-alternatives').appendTo("body").modal('show');



                  }

                  function openSlider(i) {
                    var node = $('a[data-resid=' + i + ']')[0];
                    window.lgData.lg0.items.forEach(function (item, i) {
                      if (item == node || ((item.id && node.id) && (item.id == node.id))) {
                        window.location.hash = "lg=1&slide=" + i;
                        window.lgData.lg0.init()
                      }
                    })
                  }

                  $(document).ready(function() {
                    setBody();
                    for(var i=0;i<gtags.length;i++) {
                      var tag = gtags[i];
                      window.App.gTag(tag[0], tag[1], tag[2]);
                    }
                  })

                  <% if (!view.butcher && __req.prefAddr) {%>

               
                              


<% } else if (view.butcher && __req.prefAddr && __req.query.action == 'add2sc') { %>

                    $(document).ready(function () {
                      window.App.scrollToAnchor("#noteanchor")
                    })


                    <% } %> 

                  
                <% if (__req.query.r) { %>

                    $(document).ready(function () {

   
                  
                    <% if (!__req.query.autoNote) { %>
                        openSlider(<%=__req.query.r %>);

                    <% } else {
                        var r = product.resources.find(p => p.id == parseInt(__req.query.r))
                        var defaultImg = product.resources.find(p => p.contentType == 'image/jpeg');
                        if (defaultImg && r && (r != defaultImg)) {
                          r.thumbnailUrl = defaultImg.thumbnailUrl;
                          r.contentUrl = defaultImg.contentUrl;
                          r.contentType = defaultImg.contentType;
                          r.folder = defaultImg.folder;
                        } 
                    %>
                    <% if (!__req.query.disableSlider) { %>
   
                      

                     <% } %>

                          setTimeout(function () {
                            <% if (r) { %>
                      <%- include('./_partial/addtonote.ejs', {
                              resource: r, options: {
                                hideProduct: __req.query.hideproduct
                              }
                            }) %>
                            <% } %>
                    }, 100);

                   
                  
                  <% } %>

                  })





                    <%} else { %>
                  
                      <%}%>



                </script>



                </body>

</html>