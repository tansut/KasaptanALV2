<!DOCTYPE html>
<html lang="tr-TR" prefix="og: http://ogp.me/ns#">

<head>
  <% include ./_partial/head %>
</head>

<body>
  <% include ./_partial/header %>




  <div class="page-title-overlap bg-accent pt-4">
    <div class="container d-lg-flex justify-content-between py-2 py-lg-3">
      <div class="order-lg-2 mb-3 mb-lg-0 pt-lg-2">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb breadcrumb-light flex-lg-nowrap justify-content-center justify-content-lg-star">
            <li class="breadcrumb-item"><a class="text-nowrap" href="/"><i class="czi-home"></i></a></li>
            <li class="breadcrumb-item text-nowrap active" aria-current="page">Alışverişimi Tamamla</li>
          </ol>
        </nav>
      </div>
      <div class="order-lg-1 pr-lg-4 text-center text-lg-left">
        <h1 class="h3 text-light mb-0">Alışverişimi Tamamla</h1>
      </div>
    </div>
  </div>

  <!-- Page Content-->
  <div class="container mb-4 ">
    <form class="needs-validation" method="post" novalidate action="/alisveris-sepetim/savereview">
      <div class="row">
        <section class="col-lg-7">
          <!-- Steps-->

          <%- include('./_partial/checkout-steps.ejs', {   step: 4        }); %>
          <div>
            <div class="d-flex flex-nowrap justify-content-between align-items-center pt-1 pb-1 mb-2">
              <h3 class="h4 mb-0 mr-2">Adres</h3>

              <a href="/alisveris-sepetim/adres" class="btn btn-sm btn-light">Düzenle<i
                  class="czi-arrow-right ml-1 mr-n1"></i></a>

            </div>
            <ul class="list-unstyled font-size-sm">
              <li><span class="text-muted">İsim:&nbsp;</span><%= shopcard.address.name %></li>
              <li><span class="text-muted">Adres:&nbsp;</span><%= shopcard.address.adres%>
                <%= shopcard.address.level3Text%>/<%= shopcard.address.level1Text%></li>
              <li><span class="text-muted">Telefon:&nbsp;</span><%= shopcard.address.phone%></li>
            </ul>
          </div>
          <div>
            <div class="d-flex flex-nowrap justify-content-between align-items-center pt-1  pb-1 mb-2">
              <h3 class="h4 mb-0 mr-2">Teslimat ve Ödeme</h3>

              <a href="/alisveris-sepetim/ship" class="btn btn-sm btn-light">Düzenle<i
                  class="czi-arrow-right ml-1 mr-n1"></i></a>

            </div>
            <% for (let bi in shopcard.shipment) { %>
            <% let shipment = shopcard.shipment[bi]%>
            <div class="border mb-4">


              <div class="bg-secondary p-3  mb-4"><a class="media align-items-center"
                  href="/<%=shopcard.butchers[bi].slug%>"><img class="rounded-circle header-img"
                    src="<%= `${__req.helper.imgUrl('butcher-google-photos', shopcard.butchers[bi].slug)}` %>" alt="<%=shopcard.butchers[bi].name%>">
                  <div class="media-body pl-2"><span class="font-size-ms text-muted">Teslimat ve Ödeme</span>
                    <h3 class="h4 mb-0 mr-2"><%= shopcard.butchers[bi].name %></h3>
                  </div>
                </a></div>

              <ul class="px-4 list-unstyled font-size-sm">
                <li><span class="text-muted">Teslimat:&nbsp;</span><%= shopcard.shipment[bi].howToDesc %></li>
                <li><span class="text-muted">Teslimat planı:&nbsp;</span><%= shopcard.shipment[bi].desc %></li>
                <% if (shopcard.shipment[bi].type != 'callme') {%>
                <li><span class="text-muted">Gün:&nbsp;</span><%= shopcard.shipment[bi].daysText %></li>
                <li><span class="text-muted">Saat Aralığı:&nbsp;</span><%= shopcard.shipment[bi].hoursText%> </li>
                <%}%>
                        <li><span class="text-muted">Paketim çıkmadan bana haber ver:&nbsp;</span><%= __helper.boolStr(shopcard.shipment[bi].informMe)%>
                </li>
                <li><span class="text-muted">Ödeme:&nbsp;</span><%= shopcard.payment[bi].desc%> </li>
              </ul>
              <div class="px-4">
                <h6 class="h6">
                  Mesafeli Satış Sözleşmesi
                </h6>
                <div class="form-group">
                  <textarea style="font-family: 'Courier New', Courier, monospace;" class="font-size-xs form-control" rows="5" readonly><%= include('./_partial/user-butcher-agreement.ejs', {
                      user: shopcard,
                      butcher: controller.Butchers.find(b=>b.id == bi)
                    }) %>
                  </textarea>
                  <div class="custom-control custom-checkbox mb-2">
                    <input class="custom-control-input" type="checkbox" checked >
                    <label class="custom-control-label" for="si-remember">Mesafeli Satış Sözleşmesini okudum ve kabul ediyorum.</label>
                </div>
    
                </div>
              </div>


            </div>
            <%}%>
          </div>

          

          <!-- Navigation (desktop)-->
          <div class="d-none d-lg-flex ">
            <div class="w-50 pr-3"><a class="btn btn-secondary btn-block" href="/alisveris-sepetim/payment"><i
                  class="czi-arrow-left mt-sm-0 mr-1"></i><span class="d-none d-sm-inline">Geri</span><span
                  class="d-inline d-sm-none">Geri</span></a></div>
            <div class="w-50 pl-2"><button type="submit" id="save-adres" name="save-adres"
                class="btn btn-accent btn-block"><span class="d-none d-sm-inline">Onayla</span><span
                  class="d-inline d-sm-none">Onayla</span><i class="czi-arrow-right mt-sm-0 ml-1"></i></button></div>
          </div>
        </section>
        <!-- Sidebar-->
        <aside class="col-lg-5 mb-4 pt-4 pt-lg-0">


          <div class="cz-sidebar-static rounded-lg box-shadow-lg ml-lg-auto">
            <div class="widget">
              <h2 class="widget-title text-center">Siparişim</h2>
              <% for (let bi in shopcard.butchers) { %>
            <% let butcher = shopcard.butchers[bi]%>

            <div class="mb-4">
              <div class="d-flex flex-wrap justify-content-between align-items-center pt-1 border-bottom pb-1 mb-2">
                <h4 class="h5 mb-0 mr-2"><%=butcher.name%></h4>
              </div>

              <% butcher.products.forEach((pi, i) => { %>
              <% let item = shopcard.items[pi] %>
              <div class="media align-items-top pt-2 pb-2"><a class="d-block mr-2"
                  href="<%=`/${item.product.slug}?butcher=${butcher.slug}`%>">
                  <img class="header-img" src="<%=`${__req.helper.imgUrl('product-photos', item.product.slug)}`%>"
                    alt="<%=`${item.product.name}`%>" />

                </a>
                <div class="media-body">
                  <h6 class="widget-product-title"><a
                      href="<%=`/${item.product.slug}?butcher=${butcher.slug}`%>"><%=`${item.product.name}`%></a>
                  </h6>
                  <div class="d-flex justify-content-between mb-2">
                    <div>
                      <div class="font-size-sm"><span class="font-weight-medium"><%=item.quantity%></span> 
                        <span
                          class="text-muted  mr-2"> <%=item.purchaseoption.unitTitle%> </span>
                          <% if (item.purchaseoption.unitWeight) { %>
                            <span class="d-block text-muted font-size-xs"><%=item.purchaseoption.unitWeight%>/ adet</span>
                          <% } %>
                        </div>

                    </div>
                    <div class="text-nowrap font-size-sm">
                      <%- include('./_partial/currency.ejs', {value: item.price}) %>
                    </div>

                  </div>
                  <% if (item.purchaseoption.desc && item.purchaseoption.unit != 'kg') {%>
                  <!-- <div class="mb-2 font-size-sm text-muted"><%=item.purchaseoption.desc%></div> -->
                  <%}%>     
                              <!-- <div class="d-flex ">
                               
                                  <div class="text-accent font-size-sm"><span class="mr-2"> <%- include('./_partial/currency.ejs', {value: item.product.viewUnitPrice, unit: item.product.viewUnit}) %></span>
                </div>
              </div> -->



            </div>
          </div>
          <% }) %>
          <div class="d-flex justify-content-between mb-2 border-bottom">
            <div class="">
              <div class="font-size-sm">Lezzetler:</div>

            </div>
            <div class="text-nowrap font-size-sm">
              <%- include('./_partial/currency.ejs', {value: butcher.subTotal}) %>
            </div>

          </div>

          <% if (shopcard.getShippingCost(bi) > 0) { %>
          <div class="d-flex justify-content-between mb-2 border-bottom">
            <div>
              <div class="font-size-sm">Teslimat:</div>

            </div>
            <div class="text-nowrap font-size-sm">
              <%- include('./_partial/currency.ejs', {value: shopcard.getShippingCost(bi)}) %>
            </div>

          </div>

          <%}%>
                     
                       <% let discounts = shopcard.butcherDiscounts[bi] || [] %>
          <% discounts.forEach(d=> { %>
          <div class="d-flex justify-content-between mb-2 border-bottom">
            <div>
              <div class="font-size-sm"><%=d.name%></div>

            </div>
            <div class="text-nowrap font-size-sm">
              <%- include('./_partial/currency.ejs', {value: d.calculated}) %>
            </div>

          </div>
          <%})%>


          <div class="d-flex justify-content-between mb-2 font-weight-medium">
            <div>
              <div class="font-size-sm">Toplam:</div>

            </div>
            <div class="text-nowrap font-size-sm">
              <%- include('./_partial/currency.ejs', {value: shopcard.getButcherTotal(bi)}) %>
            </div>

          </div>
      </div>





      <%}%>

  <ul class="list-unstyled font-size-sm mt-4 pt-4 border-top">
    <!-- <li class="d-flex justify-content-between align-items-center"><span class="mr-2">Lezzetler:</span><span
        class="text-right">
        <%- include('./_partial/currency.ejs', {value: shopcard.subTotal}) %>

      </span></li> -->
      <% shopcard.discounts.forEach(d=>{ %>
      <li class="d-flex justify-content-between align-items-center"><span class="mr-2">
          <%=d.name %></span><span class="text-right">
          <%- include('./_partial/currency.ejs', {value: d.calculated}) %>
        </span></li>
      <%})%>
      <li class="font-weight-bolder d-flex justify-content-between align-items-center"><span class="mr-2">
          Genel Toplam:</span><span class="font-size-normal ">
          <%- include('./_partial/currency.ejs', {value: shopcard.total}) %>
        </span></li>

      </ul>

  </div>

  </aside>
  </div>
  <!-- Navigation (mobile)-->
  <div class="row d-lg-none">
    <div class="col-lg-8">
      <div class="d-flex">
        <div class="w-50 pr-3"><a class="btn btn-secondary btn-block" href="/alisveris-sepetim/payment"><i
              class="czi-arrow-left mt-sm-0 mr-1"></i><span class="d-none d-sm-inline">Geri</span><span
              class="d-inline d-sm-none">Geri</span></a></div>
        <div class="w-50 pl-2"><button type="submit" id="save-adres" name="save-adres"
            class="btn btn-primary btn-block"><span class="d-none d-sm-inline">Tamamdır</span><span
              class="d-inline d-sm-none">Tamamdır</span><i class="czi-arrow-right mt-sm-0 ml-1"></i></button></div>
      </div>
    </div>
  </div>
  </form>
  </div>

  <% include ./_partial/footer %>
  <% include ./_partial/scripts %>

</body>

</html>