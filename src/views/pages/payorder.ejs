<!DOCTYPE html>
<html lang="tr-TR" prefix="og: http://ogp.me/ns#">

<head>
  <% include ./_partial/head %>

  <style>
    @media print {
    
    
    .d-print-w-75 {
          width: 75% !important;
      }
      .d-print-w-50 {
          width: 50% !important;
      }
    
      .d-print-w-25 {
          width: 25% !important;
      }
    
      .d-print-none {
        display: none !important
      }
    
      .d-print-inline {
        display: inline !important
      }
    
      .d-print-inline-block {
        display: inline-block !important
      }
    
      .d-print-block {
        display: block !important
      }
    
  
    
    }
    </style>

</head>

<body class="<%= controller.threeDhtml ? 'd-none':''%>">
  <% include ./_partial/header %>

  <!-- Page Title (Light)-->
  <% if (__req.query.print != '1') { %>

  <div class="page-title py-2">
    <div class="container d-lg-flex justify-content-between py-2 py-lg-3">
      <div class="order-lg-2 mb-3 mb-lg-0 pt-lg-2">
        <nav aria-label="breadcrumb" class="d-none d-lg-block">
          <ol class="breadcrumb flex-lg-nowrap justify-content-center justify-content-lg-star">
          </ol>
        </nav>
      </div>
      <div class="order-lg-1 pr-lg-4 text-center text-lg-left d-print-none">
        <h1 class="h3">Online Ödeme</h1>
        <!-- <h2 class="lead h4">
          <%=order.name%>
        </h2> -->
        <h2 class="lead h4">
          <%= __helper.formatDate(order.creationDate) + ' tarihli ' + order.butcherName + ' siparişim' %></h2>
        
        <a class="font-size-xs text-muted" href="<%=__req.url%>?print=1">Yazdır &raquo;</a>
      </div>
    </div>
  </div>


<% } %>



  <div class="container mb-3 ">

    <% if (__req.query.print != '1') { %>
    <div class="d-print-none">

    

    <% if (controller.shouldBePaid > 0) { %>


    <% if (controller.mayEarnPuanTotal) { %>
    <div class="mt-3 mb-3 bg-secondary border p-3">
      <h5 class="h5">Puan kazancınız var!</h5>


      <p>
        Alışverişiniz size
        <strong class="text-info"><%- include('./_partial/currency.ejs', {value: controller.mayEarnPuanTotal}) %></strong> değerinde puan
        kazandırdı.
      </p> 

      <% if (controller.possiblePuanList.length > 0) { %>
       
          <% controller.possiblePuanList.forEach(pg => { %>
          <ul>
            <li>
              <strong><%- include('./_partial/currency.ejs', {value: pg.earned}) %></strong>, <%=pg.title%>
            </li>
          </ul>
          <% }) %>
  
       
        <%}%>
            

    </div>





      
      
        
        </div>
      <% } %>

      <% if (controller.usablePuanTotal > 0.00) { %>
        <div class="mb-3 bg-secondary border p-3">      
          <h5 class="h5">Bu alışverişiniz çok daha kârlı!</h5>
          <span class="text-dark d-block mb-2">Önceki siparişlerinizden kazandığınız 
            <strong class="text-success"><%- include('./_partial/currency.ejs', {value: controller.usablePuanTotal}) %></strong>
            değerinde puanı düşüyoruz.
          </span>
        </div>
        <% } %>       
      
      



      <p class="mt-3 text-muted text-center">
        <% if (controller.usablePuanTotal > 0.00) { %>
          <del class="d-block">
            <%- include('./_partial/currency.ejs', {value: controller.shouldBePaid}) %>
          </del>
          <%- include('./_partial/currency.ejs', {value: controller.shouldBePaid-controller.usablePuanTotal}) %>


        <% } else { %>
        <%- include('./_partial/currency.ejs', {value: controller.shouldBePaid}) %>
          
        <%} %>
      </p>


      <%}%>

      <% if (controller.shouldBePaid > 0) { %>
<div class="d-print-none">
  <%- include(`./_partial/paymentprovider/${controller.paymentProvider.providerKey}.payform.ejs`) %>

    
</div>

      <% } %>


      <a id="orderdetails"></a>
      </div>

    <% } %>
      <% if (__req.query.print != '1') { %>
      <div class="mb-3">
        <%- include('./_partial/order.details.ejs', {
          order: order,
          hidePhone: true,
          hidePayLink: true,
          hideUser: controller.hideOrderDetails
      }) %>
      </div>

<% } else { %>
<h3>
  <%=order.butcherName%>
</h3>

<ul class="list-unstyled font-size-sm">
  <li><span class="text-muted">Dağtımı yapacak:&nbsp;</span><%=order.dispatcherName%></li>

  <% if (!(order.dispatcherType || "").startsWith('kasaptan')) { %>
  <li><span class="text-muted">*İsim:*&nbsp;</span><%= order.name %></li>
  <% if(order.address) { %>
  <li><span class="text-muted">*Adres:*&nbsp;</span><%= order.address%>
  Bina: <%=order.bina%>,Kat: <%=order.kat%>,Daire: <%=order.daire%>

    <%= order.areaLevel3Text%>/<%= order.areaLevel1Text%></li>
    <% if (order.adresTarif) { %>
      <li>
        Adres tarifi: <%= order.adresTarif%>
      </li>
      <%}%>
    <%}%>
  <% } %>
    <% if(order.note) { %>
      <li><span class="text-muted">Not:&nbsp;</span><%= order.note%>
        </li>
    <%}%>
  <% if (order.noInteraction) { %>
  <li>Güvenli Teslimat: <%= order.noInteraction ? 'Evet': 'Hayır'%></li>
  <% } %>
</ul>

<ul class="list-unstyled ">
  <li><span class="text-muted">Teslimat planı:&nbsp;</span><%= order.shipmentHowToText %></li>
  <li><span class="text-muted">Teslimat kodu:&nbsp;</span>*<%= order.securityCode %>*</li>
  <% if (order.shipmentType != 'callme') {%>
  <li><span class="text-muted">Gün:&nbsp;</span><strong>*<%= __helper.formatDate(order.shipmentdate) %>*</strong></li>
  <li><span class="text-muted">Saat Aralığı:&nbsp;</span><strong>*<%= order.shipmenthourText%>*</strong> </li>
  <%} else { %>
    <li><span class="text-muted">Teslimat planı:&nbsp;</span>*<%= order.shipmentTypeText%>*</li>

  <% } %>
              <li><span class="text-muted">Paketim çıkmadan bana haber ver:&nbsp;</span><%= __helper.boolStr(order.shipmentInformMe)%>
  </li>
  <li><span class="text-muted">**Planlanan** Ödeme:&nbsp;</span><%= order.paymentTypeText%> </li>
  <% if (order.butcherSelection == "user") { %>
    <li><span class="text-muted">*Müşteriniz özellikle sizi diğer kasaplar arasından seçerek sipariş vermiştir.*</span></li>
  
  <% } %>
</ul>

<ul>


<% for(var i = 0; i < order.items.length; i++) { %>
<% var item = order.items[i] %>
<li>
  <p class="mb-1">
    <%=item.productName%>

  </p>
  <p>
    <%=item.quantity%>
    <%=item.pounitTitle%>
    
    <%- include('./_partial/currency.ejs', {value: item.price}) %><br>
    <%if (item.pounitWeight) { %>
      <span class="text-muted font-size-sm d-block">1 <%=item.pounitTitle%> <%=item.pounitWeight%></span>
      <% } %>

    <span class="text-muted font-size-sm">
      Birim Fiyatı: 
      <%- include('./_partial/currency.ejs', {value: item.pounitPrice}) %> /<%=item.pounitTitle%>     

    </span>

    <% if (item.pounit != 'kg') { %>
      <span class="text-muted font-size-sm ">
        
          Kg Fiyatı: 
          <%- include('./_partial/currency.ejs', {value: item.kgPrice}) %> /<%='KG'%>    
       
 
      </span>
    <% } %>

    <% if (item.note) {%>     
      <div class="font-size-sm text-info"><span class="font-weight-bold">Not:</span> <%=item.note%></div>
      <%}%> 
  </p>

  
  




  
</li>
<% } %>
</ul>
<% } %>









    </div>








    <% include ./_partial/footer %>
    <% include ./_partial/scripts %>



    <script>



<% if (__req.query.print=='1') { %>
  window.print();
<%}%>




      function beforeSubmit() {
        var n = $("#pan").val() || "";
        $("#pan").val(n.replace(/\s+/g, ''))       
        setTimeout(function () { $('#pay-btn').text(' Ödemenizi yapıyorum ... '); $('#pay-btn').attr('disabled', true); })
      }

<% if (controller.threeDhtml) { %>

        $(window).on('load', function () {
          $('#threeDmodal').modal('show');
          setTimeout(function () { $(document.body).removeClass("d-none") }, 250);
        })

        <% } %>

          new Card({
            form: document.querySelector('.interactive-credit-card'),
            container: '.card-wrapper',
            formSelectors: {
              numberInput: 'input#pan', // optional — default input[name="number"]
              expiryInput: 'input#expiry', // optional — default input[name="expiry"]
              cvcInput: 'input#cvv', // optional — default input[name="cvc"]
              nameInput: 'input#cardOwner' // optional - defaults input[name="name"]
            },
          });

    </script>

</body>

</html>