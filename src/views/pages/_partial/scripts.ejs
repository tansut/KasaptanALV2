<% if (config.pagetrack == "true" && (!__req.user || !__req.user.hasRole('admin') )) { %>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146976156-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'UA-146976156-1');
</script>
<% } %>

<script  src="/static/js/vendor.min.js?v=<%=__config.versionKey%>"></script>
<script  src="/static/js/site.min.js?v=<%=__config.versionKey%>"></script>
<script src="/static/js/app.js?v=<%=__config.versionKey%>"></script>



<script>



  window.shopcard = {
    card: {
      data: <%- JSON.stringify(__shopcard() || { items: [] }) %>,
    }
  };

  window.shopcard.count = new Vue({
    el: '#shopcardcount',
    data: {
      card: window.shopcard.card
    }
  })

  $('.searchBox').autoComplete({
    resolverSettings: {
      url: '/api/v1/fts'
    },
    events: {
      searchPost: function (res, el) {
        debugger;
        window.__searchResult = res;
        window.dataLayer = window.dataLayer || [];
                    window.dataLayer.push({
                    'event': 'custom',
                    'category': 'search',
                    'action':'search/autocomplete',
                    'label': el.val()
                    });

        return res.map(function (p) {
          return {
            id: p.id,
            text: p.name
          }
        })
        // return window.__searchResult;
      }

    }
  });

  $('.searchBox').on('autocomplete.select', function (evt, item) {
    let go = window.__searchResult.find(function (result) {
      return result.id == item.id
    });
    window.location.href = go.url;
  });
</script>
<% if (typeof _usrmsg != 'undefined') { %>
<script>
  window.App.alert("<%=_usrmsg.text%>", "<%=_usrmsg.type %>")
</script>
<% } %>


<script>





  $(document).ready(function () {

    var ulg = window.kb.userlocation();
    var guideinited = false;
    var inited = false;



    var userGuide = {
      guideinited: false,
      autoPopuped: window.App.getCookie("guidewindow"),
      open: function () {
        if (!this.guideinited) {
          this.guideinited = true;
          ulg.init({
            openDistricts: false,
            cityDomSelector: "#guidecityselectpicker",
            districtDomSelector: "#guidedistrictselectpicker"
          }, function () {
            $('#meatGuideModal').modal();
            $("#meat-guide-close-button").click(function () {
              f = $("#meat-guide-form")[0]
              if (f.checkValidity()) {
                
                $.ajax({
                  type: "POST",
                  url: "/api/v1/sitelog/create",
                  data: {
                    //district: ulg.selectedDistrict.name,
                    city: ulg.selectedCity.name,
                    email: $("#user-email").val(),
                    logtype: "anonymous-user-download-meat-guide"
                  },
                  success: function () {
                    window.App.gTag('meat-guide', ulg.selectedCity.name, $("#user-email").val())
                    $('#meatGuideModal').modal("hide");
                    alert("Teşekkürler")
                  }
                }
                )
              }
            });
            $('#meatGuideModal').on('shown.bs.modal', function () {

            })
          });
        } else $('#meatGuideModal').modal("show")

      }
    }


    $(".select-area-action").click(function () {
      window.kb.selectArea(function (sender, ul) {
        window.location.href = "/adres-belirle/" + ul.selectedDistrict.slug + '?r=' + window.location.href;
        //window.location.reload(true) // = "/" + window.App.ProductApp.product.slug + "?semt=" + ul.selectedDistrict.slug

      });
    })

    $(".explore-area-action").click(function () {
      window.kb.selectArea(function (sender, ul) {
        window.location.href = "/" + ul.selectedDistrict.slug + "-kasap?save=1"

      });
    })

    $(".get-userguide-action").click(function () {
      userGuide.open();
    })


    $(window).scroll(function () {
      if (($(document).scrollTop() >= $(document).height() / 3) && !userGuide.autoPopuped) {
        userGuide.autoPopuped = true;
        window.App.setCookie("guidewindow", "1", 30);
        userGuide.open();
      }
    });

  })

</script>



<script>
  $(document).ready(function () {

    if (window.lgData && window.lgData.lg0) {
      $(window.lgData.lg0.el).on('onAfterSlide.lg',function(event){
        var node = window.lgData.lg0.items[event.detail.index];
        if (node) {
          if ($(node).data('gtrack')) {
            var href = $(node).attr('href');
            var type = $(node).data('restype');
            var ref = $(node).data('resref');
            var title = $(node).data('restitle');
            //console.log(type, ref + '/' + title, href)
            window.App.gTag('gallery/' + type, ref + '/' + title, href)
          }
        }
      });
    }


    


     $('#areaModal').on('shown.bs.modal', function () {
            window.App.gTag('dialogs', 'open', 'location')
    
          })

    $('#meatGuideModal').on('shown.bs.modal', function () {
            window.App.gTag('dialogs', 'open', 'meat-guide')
    
          })

    $('#signin-modal').on('shown.bs.modal', function () {
            window.App.gTag('dialogs', 'open', 'login')
    
          })
        

    $('#signup-tab-a').on('shown.bs.tab', function (e) {
      $('#su-tel').focus();
    })

    $('#signin-tab-a').on('shown.bs.tab', function (e) {
      $('#si-email').focus();
    })

    var allImages = document.querySelectorAll(".gallery-item");
    allImages.forEach((value) => {
      value.oncontextmenu = (e) => {
        e.preventDefault()
        return false;
      }
    })
  });


</script>

<script>
$('#__whatsup').floatingWhatsApp({
    phone: '908503054216',
    popupMessage: 'Nasıl yardımcı olabilirim ?',
    showPopup: false,
    showOnIE: false,
    headerTitle: 'Hoşgeldiniz!',
    position: 'right',
    zIndex: '1030',
    message: '<%= typeof(__supportMessage) == "undefined" ? '': __supportMessage %>',
    size: '3.2rem',
    //buttonImage: '<img src="/static/img/logo-home.png" />'
    
  });

</script>
<% if (!__req.user) { %>

<script>
  window.App.User = {
    isAuthenticated: false
  }
</script>



<% } else { %>

<script>
  window.App.User = {
    isAuthenticated: <%=__req.user ? true : false %>,

    prefAdr: <%- JSON.stringify(__req.prefAddr || {}) %>
  }
</script>



<%}%>